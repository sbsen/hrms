
@{
    ViewBag.Title = "ITDeclarationForm";
}

@System.Web.Optimization.Styles.Render("~/bundles/datepickercss")
@System.Web.Optimization.Scripts.Render("~/bundles/datepicker")
<script src="~/Scripts/moment.min.js"></script>


<script src="~/Scripts/daterangepicker.min.js"></script>
<link href="~/Content/daterangepicker.css" rel="stylesheet" />

<link href="~/Content/css/select2.min.css" rel="stylesheet" />
<script src="~/Scripts/select2.min.js"></script>
<style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .update-info {
        font-weight: 500;
        font-style: italic;
        font-size: 13px;
        margin-right: 30px;
        margin-top: -5px;
        color:#dc3545;
    }

        .update-info span {
            font-weight: bold;
        }
</style>
<body>
    <div class="card">
        <div class="card-header">
            IT Declaration Form
        </div>
        <div class="card-body">
            <div class="row col-lg-12 p-b-10">
                <div class=" col-lg-3">
                    <label class="p-0 col-lg-12">Employee Code</label>
                    <input class="col-lg-12 form-control" id="empCode" disabled />
                </div>
                <div class="  col-lg-3">
                    <label class="p-0 col-lg-12">Employee Name</label>
                    <input class="col-lg-12 form-control" id="empName" disabled />
                </div>
                <div class=" col-lg-3">
                    <label class="p-0 col-lg-12">Employee Department</label>
                    <input class="col-lg-12 form-control" id="empDept" disabled />
                </div>
                <div class=" col-lg-3">
                    <label class="p-0 col-lg-12">Employee Designation</label>
                    <input class="col-lg-12 form-control" id="empDesgn" disabled />
                </div>
            </div>
            <div class="row col-lg-12  p-b-10">
                <div class=" col-lg-3">
                    <label class="p-0 col-lg-12">Employee PAN Details</label>
                    <input class="col-lg-12 form-control" id="empPAN" disabled />
                </div>
                <div class=" col-lg-3">
                    <label class="p-0 col-lg-12">Employee Address</label>
                    <input class="col-lg-12 form-control" id="empAddress" disabled />
                </div>
                <div class="col-lg-3">
                    <label class="p-0 col-lg-12">Select Financial Year</label>
                    <select id="ddlFinYear" class="form-control"></select>
                    @*<input type="number" class="col-lg-12 form-control" id="FinancialYear" />*@
                </div>
                <div class="col-lg-3 text-right">
                    <span id="formSubmitDate" class="update-info pull-right m-top-10 p-t-35 "></span>
                </div>
            </div>


            <div>
                <ul class="nav nav-tabs getactivetab" id="">
                    <li class="nav-item">
                        <a data-id="1" class="nav-link active dashboard_nav_active HouseRentDetailsLink" id="HouseRentDetailsLink" data-toggle="tab" href="#Content_HouseRent">House Rent Allowance</a>
                    </li>
                    <li class="nav-item">
                        <a data-id="2" class="nav-link dashboard_nav_active HomeLoanDetailsLink" id="HomeLoanDetailsLink" data-toggle="tab" href="#Content_HomeLoan">Deduction of interest on borrowing</a>
                    </li>
                    <li class="nav-item">
                        <a data-id="3" class="nav-link  dashboard_nav_active itFormTableDetailsLink" id="itFormTableDetailsLink" data-toggle="tab" href="#Content_IT_table">Deduction under Chapter VI-A</a>
                    </li>
                    <li class="nav-item">
                        <a data-id="4" class="nav-link  dashboard_nav_active otherIncomeDetailsLink" id="otherIncomeDetailsLink" data-toggle="tab" href="#Content_otherIncome">Other Source of Income</a>
                    </li>
                    @*<li class="nav-item">
                            <a data-id="5" class="nav-link  dashboard_nav_active summaryDetailsLink" id="summaryDetailsLink" data-toggle="tab" href="#Content_summary">Summary</a>
                        </li>*@



                    @*<li class="nav-item managerCommends">
                            <a data-id="4" class="nav-link dashboard_nav_active ManagerCommends" id="ManagerCommends" data-toggle="tab" href="#Manager_Commends">Feedback</a>
                        </li>*@

                </ul>
            </div>
            <div class="tab-content p-t-10">

                <div class="tab-pane Content_HouseRent active" id="Content_HouseRent">
                    <div class="card-body" id="appraisalProcessContentDiv">

                        <div class="row col-lg-12 p-b-10">
                            <div class="col-lg-12 text-right">
                                <button class="btn btn-danger btnUploadCls"><i class="fa fa-upload"></i>&nbsp;Upload files</button>
                            </div>
                        </div>

                        <div class="row col-lg-12">
                            @*<div class=" col-lg-4">
                                    <label class="p-0 col-lg-12">
                                        Rental Period
                                    </label>
                                    <input type="text" name="datefilter" id="daterangefilter" onkeydown="return false" placeholder="From Date - To Date" class="clearcls text-center col-lg-12 datefilter form-control" />
                                </div>
                                <div class="col-lg-3">
                                    <label class="p-0 col-lg-12">Landlord’s PAN&nbsp;&nbsp;<i class="fa fa-info-circle landlordInfo" title="if the Rental Amount's total exceeds ₹1,00,000, then Landlord's PAN is mandatory...! " onmouseover="LandlordTooltip()"></i></label>

                                    <input type="text" class="form-control col-lg-12 clearcls" id="landlordPAN" />
                                </div>*@
                            <div class="col-lg-6 form-group row">
                                <div class="col-lg-5 text-right">
                                    <label>Rental Period</label>
                                </div>
                                <div class="col-lg-7">
                                    <input type="text" name="datefilter" id="daterangefilter" onkeydown="return false" placeholder="From Date - To Date" class="validationinputcls requirAddcls homerentInputcls clearcls admincls text-center col-lg-12 datefilter form-control" />
                                </div>
                            </div>
                            <div class="col-lg-6 form-group row">
                                <div class="col-lg-5 text-right">
                                    <label class="col-lg-12 p-r-0">Landlord’s PAN&nbsp;&nbsp;<i class="fa fa-info-circle  landlordInfo" title="if the Rental Amount's total exceeds ₹1,00,000, then Landlord's PAN is mandatory...! " onmouseover="LandlordTooltip()"></i></label>
                                </div>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control col-lg-12 clearcls admincls" id="landlordPAN" />
                                </div>
                            </div>
                        </div>
                        <div class="row col-lg-12">
                            @*<div class=" col-lg-4">
                                    <label class="p-0 col-lg-12">
                                        LandLord Name
                                    </label>
                                    <input type="text" class="form-control col-lg-12 clearcls" id="txtname" />
                                </div>
                                <div class=" col-lg-4">
                                    <label class="p-0 col-lg-12">
                                        Address
                                    </label>
                                    <textarea id="address" class="form-control col-lg-12 clearcls"></textarea>
                                </div>
                                <div class=" col-lg-4">
                                    <label class="p-0 col-lg-12">
                                        Rental Amount(₹)
                                    </label>
                                    <input type="text" id="Rentamt" class="form-control formatNumbercls col-lg-12 clearcls" />
                                </div>*@
                            <div class="col-lg-6 form-group row">
                                <div class="col-lg-5 text-right">
                                    <label> LandLord Name</label>
                                </div>
                                <div class="col-lg-7">
                                    <input type="text" class="form-control col-lg-12 clearcls admincls requirAddcls homerentInputcls validationinputcls" id="txtname" />
                                </div>
                            </div>
                            <div class="col-lg-6 form-group row">
                                <div class="col-lg-5 text-right">
                                    <label> Address</label>
                                </div>
                                <div class="col-lg-7">
                                    <textarea id="address" class="form-control col-lg-12 clearcls admincls requirAddcls homerentInputcls validationinputcls"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            @*<label class="col-lg-6">Acual Amount(₹)</label>
                                <input type="number" id="OtherActualAmt" disabled class="col-lg-6 form-control  clearcls" />*@


                            <div class="col-lg-6 form-group row">
                                <div class="col-lg-5 text-right">
                                    <label>Rental Amount(₹)</label>
                                </div>
                                <div class="col-lg-7">
                                    <input type="number" id="Rentamt" class="form-control formatNumbercls requirAddcls homerentInputcls col-lg-12 clearcls admincls validationinputcls" />
                                </div>
                            </div>
                            <div class="col-lg-6 form-group row">
                                <div class="col-lg-5 text-right">
                                    <label> Acual Amount(₹)</label>
                                </div>
                                <div class="col-lg-7">
                                    <input type="number" id="HRA_ActualAmt" disabled class=" form-control  clearcls" />
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-12 text-right">
                            <button onclick="AddHomeRentDetails()" id="btnEditSaveHomeRent" hidden class="btn btn-success text-right "><i class=""></i>&nbsp;Save</button>
                            <button onclick="AddHomeRentDetails()" id="btnAddHomeRent" class="btn btn-primary text-right "><i class="fa fa-plus-circle"></i>&nbsp;Add</button>
                            <button onclick="nextTab()" class="btn btn-primary text-right "><i class="fa fa-arrow-right "></i>&nbsp; Next</button>
                        </div>
                    </div>
                    <div id="homeRentTableDiv" hidden>
                        <div class="card-header">
                            Home Rent Details
                        </div>
                        <div class="card-body">
                            <div class="MTS_Table">
                                <table class="table table-bordered table-responsive" id="homeRentTable" width="100%">
                                    <thead>
                                    </thead>
                                    <tbody></tbody>
                                    <tfoot>
                                        <tr style="font-weight: bold;">
                                            <td colspan="6"></td>
                                            <td id="declaredtotal"></td>
                                            <td id="actualtotal"></td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane Content_HomeLoan" id="Content_HomeLoan">
                    <div class="card-body">
                        <div class="row col-lg-12 p-b-10">
                            <div class="col-lg-12 text-right">
                                <button class="btn btn-danger btnUploadCls"><i class="fa fa-upload"></i>&nbsp;Upload files</button>
                            </div>
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Principal Paid on Home Loan(₹)</label>
                            <input type="number" id="principalPaid" class="form-control col-lg-6 interestDeductioncls requirAddcls clearcls admincls validationinputcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Interest Paid on Home Loan(₹)</label>
                            <input type="number" id="interestPaid" class="col-lg-6 form-control interestDeductioncls requirAddcls clearcls admincls validationinputcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Name of the Lender</label>
                            <input type="text" id="nameLender" class="col-lg-6 form-control  clearcls admincls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Lender PAN</label>
                            <input type="text" id="HouseLoanlenderPAN" class="col-lg-6 form-control  clearcls admincls" />
                        </div>
                        <div class=" col-lg-12 p-b-10 text-right">
                            <button class=" btn btn-primary pull-left" onclick="goBackTab()" id="btnback">Back</button>
                            <button onclick="AddHouseLoanDetails()" id="btnAddHomeLoan" class="btn btn-success text-right btnadminbeforeapprovecls"><i class=""></i>&nbsp;Save</button>
                            <button onclick="nextTabfromHomeLoan()" class="btn btn-primary text-right "><i class="fa fa-arrow-right "></i>&nbsp;Next</button>
                        </div>
                    </div>
                </div>
                <div class="tab-pane Content_IT_table" id="Content_IT_table">
                    <div class="card-body">
                        <div class="MTS_Table">
                            <table class="table table-bordered table-responsive" width="100%" id="itFormTable">
                                <thead>
                                </thead>
                                <tbody></tbody>
                                <tfoot>
                                    <tr style="font-weight: bold;">
                                        <td colspan="6"></td>
                                        <td id="ITdeclaredtotal"></td>
                                        <td id="ITactualtotal"></td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="col-lg-12 text-right p-t-10">
                            <button class=" btn btn-primary pull-left" onclick="goBackTab()" id="btnback">Back</button>
                            <button onclick="nextTab()" class="btn btn-primary text-right "><i class="fa fa-arrow-right "></i>&nbsp; Next</button>
                        </div>
                    </div>
                </div>
                <div class="tab-pane Content_otherIncome" id="Content_otherIncome">
                    <div class="card-body">
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Income from other sources(₹)</label>
                            <input type="number" id="incomeotherSource" class="form-control col-lg-6 otherInputcls clearcls admincls validationinputcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Interest Earned from Savings Deposit(₹)</label>
                            <input type="number" id="SavingsInterest" class="col-lg-6 form-control otherInputcls clearcls admincls validationinputcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Interest Earned from Fixed Deposit(₹)</label>
                            <input type="number" id="FixedInterest" class="col-lg-6 form-control otherInputcls clearcls admincls validationinputcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Total(₹)</label>
                            <input type="number" id="OtherTotalAmt" disabled class="col-lg-6 form-control  clearcls " />
                        </div>

                        <div class="col-lg-12 p-t-10 text-right ">
                            <button class=" btn btn-primary pull-left" onclick="goBackTab()" id="btnback">Back</button>
                            <button onclick="addOtherSourceIncomeDetails()" id="btnAddOtherIncome" class="btn btn-success text-right btnadminbeforeapprovecls"><i class=""></i>&nbsp; Save</button>
                        </div>
                        <div class="col-lg-12 p-t-10 text-right ">
                            <button onclick="finalSubmit()" id="btnFinalSubmit" class="btn btn-success text-right "><i class=""></i>&nbsp;Final Submit</button>
                        </div>

                    </div>
                </div>
                <div class="tab-pane Content_summary" id="Content_summary">
                    <div class="card-body">
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Total HRA(₹)</label>
                            <input type="number" disabled id="summTotalHRA" class="form-control col-lg-6  clearcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Principal Paid on Home Loan(₹)</label>
                            <input type="number" disabled id="summPrincipalPaid" class="form-control col-lg-6  clearcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Interest Paid on Home Loan(₹)</label>
                            <input type="number" disabled id="summInterestPaid" class="form-control col-lg-6  clearcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Total Declared Amount(₹)</label>
                            <input type="number" disabled id="summTotalSubmitted" class="form-control col-lg-6  clearcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Total Actual Amount(₹)</label>
                            <input type="number" disabled id="summTotalActual" class="form-control col-lg-6  clearcls" />
                        </div>
                        <div class="row col-lg-12 p-b-10">
                            <label class="col-lg-6">Total Other Source of Income Amount(₹)</label>
                            <input type="number" disabled id="summTotalOther" class="form-control col-lg-6  clearcls" />
                        </div>
                        <div class="col-lg-12 p-t-10 text-right ">
                            <button class=" btn btn-primary pull-left" onclick="goBackTab()" id="btnback">Back</button>
                            <button class="btn btn-success text-right "><i class=""></i>&nbsp;Submit</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</body>
<script>
    var Employee_ID = 0;
    var CurrSection;
    var tempSubmittedOn = false;
    var tempApprovedOn = false;
    var tempSubmittedDate = '';
    var tempApprovedDate = '';
    var PreviousTr;
    var PreviousTd;
    var CurrYear = [];
    var itFormTableDetails;
    var tempHomeRentDetail;
    var SectionDetails = [];
    var DescriptionDetails = [];
    var addCount = 0;
    var HouseRentDetails = [];
    var HouseLoanDetails = [];
    var TotalRentAmountDetails = [];
    var employeeDetails = [];
    var SummaryDetails = [];
    var otherSourceIncomeDetails = [];
    var HourseRentRowID = 0;
    var HomeLoanRowID = 0;
    var homeRentTableDetails;
    var OtherIncomeRowID=0;
    $(document).ready(function () {
        if ('@ViewBag.DirectITDeclaration' == 'False') {
            $('.admincls').prop('disabled', true);

            Employee_ID = '@ViewBag.EmpID';
        }



        debugger
        getEmployeeDetails();
        getSectionDescriptionDetails();

        // formTableCall();


        $('.select2cls').select2({ 'width': '100%' });

        $('.datefilter').daterangepicker({
            autoUpdateInput: false,

            locale: { cancelLabel: 'Clear' },

        }).keydown(function (e) {

            if (e.keyCode == 8 || e.keyCode == 46) {
                $(this).val('');
                $('.requirAddcls').trigger('input');

            }
        });
        $('.datefilter').val('');
        $('.datefilter').on('apply.daterangepicker', function (ev, picker) {
            debugger
            $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));
            $('.requirAddcls').trigger('input');

        });
        $('.datefilter').on('cancel.daterangepicker', function (ev, picker) {
            debugger
            $(this).val('');
            $('.requirAddcls').trigger('input');
        });

        //$('#FinancialYear,#LoanFinancialYear').datepicker({
        //    format: "yyyy",
        //    minViewMode: "years",
        //    autoclose: true
        //});
        getFinancialYear();

        $("#ddlFinYear").html('');
        $("#ddlFinYear").append('<option value="' + 0 + '">' + "----Select Year----" + '</option>');
        $.each(CurrYear, function (i, val) {
            $("#ddlFinYear").append('<option value="' + val.Id + '">' + val.Financial_Year + '</option>');
        });



    });


    $('.dashboard_nav_active').on('click', function () {
        $('.tab-pane').removeClass('active');
        $($(this).attr('href')).addClass('active');
    });



    $('#ddlFinYear').on('change', function () {
        $('.field-validation-valid').text('');
        $('.field-validation-valid').show();
        $('.clearcls').val('');
        $('.validationinputcls').removeClass('requir');
        if ($('#ddlFinYear').val() == 0 || $('#ddlFinYear').val() == '') {
            $('.admincls,.disableSubAmtcls ').prop('disabled', false);
            $('#btnEditSaveHomeRent').prop('hidden', true);
            $('#btnAddHomeRent,#btnAddHomeLoan,#btnFinalSubmit,#btnAddOtherIncome').show();
            $('#formSubmitDate').html('');
        }

        gethomeRentDetails($(this).val());
        getHomeLoanDetails($(this).val());
        getOtherSourceIncomeDetails($(this).val());
        getSummaryTabDetails($(this).val());
        $('#homeRentTableDiv').prop('hidden', false);

    });

    //$('.formatNumbercls').on('change', function (e) {
    //    debugger
    //    var num = e.target.value.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    //    $(this).val(num);
    //});

    $('.otherInputcls').on('input', function () {
        debugger
        $('.field-validation-valid').text('');
        $('.field-validation-valid').show();
        var sum = 0;
        var count = 0;
        for (var i = 0; i < $('.otherInputcls').length; i++) {
            sum = sum + parseFloat(($('.otherInputcls')[i].value) == '' ? 0 : $('.otherInputcls')[i].value);
            if ($('.otherInputcls')[i].value != '') {
                count++;
            }
        }
        $('#OtherTotalAmt').val(sum);
        if (count > 0) {
            $('.otherInputcls').addClass('requir');
        }
        else {
            $('.otherInputcls').removeClass('requir');
        }
    });

    $('.requirAddcls').on('input', function () {
        debugger
        $('.field-validation-valid').text('');
        $('.field-validation-valid').show();
        var count = 0;
        for (var i = 0; i < $('.requirAddcls:visible').length; i++) {
            if ($('.requirAddcls:visible')[i].value != '') {
                count++;
            }
        }
        if (count > 0) {
            $('.requirAddcls:visible').addClass('requir');
        }
        else {
            $('.requirAddcls:visible').removeClass('requir');
        }
    });
    //$('.homerentInputcls').on('input', function () {
    //    debugger
    //    $('.field-validation-valid').text('');
    //    $('.field-validation-valid').show();
    //    var count = 0;
    //    for (var i = 0; i < $('.homerentInputcls').length; i++) {
    //        if ($('.homerentInputcls')[i].value != '') {
    //            count++;
    //        }
    //    }
    //    if (count > 0) {
    //        $('.homerentInputcls').addClass('requir');
    //    }
    //    else {
    //        $('.homerentInputcls').removeClass('requir');
    //    }
    //});

    $('.btnUploadCls').on('click', function () {

        var Selectedyear = []
        var financialYear = $('#ddlFinYear').val();
        Selectedyear = CurrYear.filter(m => m.Id = financialYear);
        var lastSubmit = Selectedyear[0].Last_Submission_Date;
        var curr_date = new Date();
        if (curr_date > new Date(lastSubmit) || (tempApprovedOn == true)) {
            toastr.warning("Proof submission time has closed/your form has already been approved by Admin");
            return false;
        }
    });


    function validationinputclsFn()
    {
        debugger
        $('.field-validation-valid').text('');
        $('.field-validation-valid').show();
        for(var i=0;i<$('.validationinputcls:visible').length;i++)
        {
            if ($('#' + $('.validationinputcls:visible')[i].id).val() == '') {
                $('#' + $('.validationinputcls:visible')[i].id).addClass('requir');
                $('<span class="field-validation-valid col-lg-8 text-right">' + ' This field is required...!</span>').css('color', 'red').insertAfter('#' + $('.validationinputcls:visible')[i].id);
            }
        }


    }

    function getOtherSourceIncomeDetails(data) {
        $.ajax({
            type: 'get',
            async: false,
            url: '@Url.Content("~/ITDeclaration/getOtherSourceIncomeDetails")',
            data: { year: data, Employee_ID: Employee_ID },
            success: function (data) {
                if (data.success) {
                    otherSourceIncomeDetails = JSON.parse(data.result1);
                    if (otherSourceIncomeDetails.length != 0) {
                        OtherIncomeRowID = (otherSourceIncomeDetails[0].ID) == null ? 0 : otherSourceIncomeDetails[0].ID;
                        $('#incomeotherSource').val(otherSourceIncomeDetails[0].Income_Amount);
                        $('#SavingsInterest').val(otherSourceIncomeDetails[0].INTEREST_EARNED_FROM_SAVINGS_DEPOSIT);
                        $('#FixedInterest').val(otherSourceIncomeDetails[0].INTEREST_EARNED_FROM_FIXED_DEPOSIT);
                        $('.otherInputcls').trigger('input');
                    }
                }
            }
        });
    }


    function goBackTab() {

        var ref_this = $("ul.getactivetab li a.active");

        $("ul.getactivetab li a.active").removeClass("active");
        $("div.tab-content div.active").removeClass("active");
        if (ref_this.data("id") == 2) {
            $("ul.getactivetab li a.HouseRentDetailsLink").addClass("active");
            $("div.tab-content div.Content_HouseRent").addClass("active");
        } else if (ref_this.data("id") == 3) {
            $("ul.getactivetab li a.HomeLoanDetailsLink").addClass("active");
            $("div.tab-content div.Content_HomeLoan").addClass("active");
        } else if (ref_this.data("id") == 4) {
            $("ul.getactivetab li a.itFormTableDetailsLink").addClass("active");
            $("div.tab-content div.Content_IT_table").addClass("active");
        }
        else if (ref_this.data("id") == 5) {
            $("ul.getactivetab li a.otherIncomeDetailsLink").addClass("active");
            $("div.tab-content div.Content_otherIncome").addClass("active");
        }
    }

    function nextTabfromHomeLoan()
    {
        debugger
        var financialYear = $('#ddlFinYear').val();
        if (financialYear == '' || financialYear == 0) {
            toastr.warning('select financial year');
            return false;
        }
        getSectionDescriptionDetails();
        $("ul.getactivetab li a.active").removeClass("active");
        $("div.tab-content div.active").removeClass("active");
        $("ul.getactivetab li a.itFormTableDetailsLink").addClass("active");
        $("div.tab-content div.Content_IT_table").addClass("active");
        itFormTableDetails.$('img#viewDetails80C').trigger('click').draw(false);
     //   itFormTableDetails.$('img#viewDetails80EE').trigger('click').draw(false);
        
    //    itFormTableDetails.page('next').draw(false)
    }

    function nextTab() {
        var ref_this = $("ul.getactivetab li a.active");

        $("ul.getactivetab li a.active").removeClass("active");
        $("div.tab-content div.active").removeClass("active");

        if (ref_this.data("id") == 1) {
            $("ul.getactivetab li a.HomeLoanDetailsLink").addClass("active");
            $("div.tab-content div.Content_HomeLoan").addClass("active");
        } else if (ref_this.data("id") == 2) {
            $("ul.getactivetab li a.itFormTableDetailsLink").addClass("active");
            $("div.tab-content div.Content_IT_table").addClass("active");
        } else if (ref_this.data("id") == 3) {
            $("ul.getactivetab li a.otherIncomeDetailsLink").addClass("active");
            $("div.tab-content div.Content_otherIncome").addClass("active");
        }
        else if (ref_this.data("id") == 4) {
            $("ul.getactivetab li a.summaryDetailsLink").addClass("active");
            $("div.tab-content div.Content_summary").addClass("active");
        }

    }
    function getEmployeeDetails() {
        $.ajax({
            type: 'get',
            async: false,
            url: '@Url.Content("~/ITDeclaration/getEmployeeDetails")',
            data: { Employee_ID: Employee_ID },
            success: function (data) {
                if (data.success) {
                    employeeDetails = JSON.parse(data.result1);
                    if (employeeDetails.length != 0) {

                        var address = (employeeDetails[0].CurrentBuilding_Plot == null ? '' : employeeDetails[0].CurrentBuilding_Plot) + ' ' + (employeeDetails[0].CurrentCity == null ? '' : employeeDetails[0].CurrentCity) + ' ' + (employeeDetails[0].CurrentState == null ? '' : employeeDetails[0].CurrentState) + ' ' + (employeeDetails[0].CurrentPincode == null ? '' : employeeDetails[0].CurrentPincode)
                        $('#empCode').val(employeeDetails[0].Emp_Code);
                        $('#empName').val(employeeDetails[0].Emp_Name);
                        $('#empDept').val(employeeDetails[0].Department);
                        $('#empDesgn').val(employeeDetails[0].Designation);
                        $('#empPAN').val(employeeDetails[0].Pancard);
                        $('#empAddress').val(address);
                    }
                }
            }
        });
    }
    function addOtherSourceIncomeDetails() {
        var financialYear = $('#ddlFinYear').val();
        if (financialYear == '' || financialYear == 0) {
            toastr.warning('select financial year');
            return false;
        }
        if ('@ViewBag.DirectITDeclaration' == 'True') {
            validationinputclsFn();
        }
        if ($('.field-validation-valid').text() != '') {
            return false;
        }
        $.ajax({
            type: 'post',
            url: '@Url.Content("~/ITDeclaration/addOtherSourceIncomeDetails")',
            data: { Id: OtherIncomeRowID, financialYear: financialYear, incomeOtherSource: $('#incomeotherSource').val(), savingsInterst: $('#SavingsInterest').val(), fixedInterest: $('#FixedInterest').val(), Employee_ID: Employee_ID },
            success: function (data) {

                if (data.result == 1) {
                    toastr.success('Successfully Saved');

                }
            }
        });
    }
    function getFinancialYear() {
        $.ajax({
            type: 'get',
            url: '@Url.Content("~/ITDeclaration/getFinancialYear")',
            async: false,
            success: function (data) {
                if (data.success) {
                    CurrYear = JSON.parse(data.result);
                }
            }
        });
    }

    function getHomeLoanDetails(data) {

        $.ajax({
            type: 'get',
            async: false,
            url: '@Url.Content("~/ITDeclaration/getHomeLoanDetails")',
            data: { year: data, Employee_ID: Employee_ID },
            success: function (data) {
                if (data.success) {
                 

                    HouseLoanDetails = JSON.parse(data.result1);
                    if (HouseLoanDetails.length != 0) {
                        HomeLoanRowID = (HouseLoanDetails[0].ID) == null ? 0 : HouseLoanDetails[0].ID;
                        $('#principalPaid').val(HouseLoanDetails[0].PRINCIPAL_PAID_ON_LOAN);
                        $('#interestPaid').val(HouseLoanDetails[0].INTEREST_PAID_ON_LOAN);
                        $('#nameLender').val(HouseLoanDetails[0].NAME_OF_LENDER);
                        $('#HouseLoanlenderPAN').val(HouseLoanDetails[0].LENDER_PAN);
                      //  $('.requirAddcls').trigger('input');
                    }
                }
            }
        });
    }



    function AddHouseLoanDetails() {

        var financialYear = $('#ddlFinYear').val();
        if (financialYear == '' || financialYear == 0) {
            toastr.warning('select financial year');
            return false;
        }
        if ('@ViewBag.DirectITDeclaration' == 'True') {
            validationinputclsFn();
        }
        if ($('.field-validation-valid').text() != '') {
            return false;
        }
        $.ajax({
            type: 'post',
            url: '@Url.Content("~/ITDeclaration/AddHouseLoanDetails")',
            data: { Id: HomeLoanRowID, principalPaid: $('#principalPaid').val(), interestPaid: $('#interestPaid').val(), nameLender: $('#nameLender').val(), lenderPAN: $('#HouseLoanlenderPAN').val(), LoanFinancialYear: financialYear, Employee_ID: Employee_ID },
            success: function (data) {

                if (data.result == 1) {
                    toastr.success('Successfully Saved');


                }
            }
        });
    }

    function validationHomeRent()
    {
        $('.field-validation-valid').text('');
        $('.field-validation-valid').show();
        for (var i = 0; i < $('.validationinputcls:visible').length; i++) {
            if ($('#' + $('.validationinputcls:visible')[i].id).val() == '') {
                $('#' + $('.validationinputcls:visible')[i].id).addClass('requir');
                $('<span class="field-validation-valid">' + ' This field is required...!</span>').css('color', 'red').insertAfter('#' + $('.validationinputcls:visible')[i].id);
            }
        }
      // var total=parseFloat(TotalRentAmountDetails[0].Total_Rental) + parseFloat($('#Rentamt').val()) ;
        if ('@ViewBag.DirectITDeclaration' == 'True' && (tempSubmittedOn == false)) {
            if (parseFloat($('#Rentamt').val()) >= 100000 && $('#landlordPAN').val() == '') {
                $('#landlordPAN').addClass('requir');
                $(".landlordInfo").tooltip('show');
            }
            else
            {
                $('#landlordPAN').removeClass('requir');
                $(".landlordInfo").tooltip('hide');
            }
        }

        


    }

    function AddHomeRentDetails() {
        if ('@ViewBag.DirectITDeclaration' == 'True') {
            validationHomeRent();
        }
        var StartDate = $('input[name="datefilter"]').val().split("-")[0];
        var EndDate = $('input[name="datefilter"]').val().split("-")[1];

        var financialYear = $('#ddlFinYear').val();
        if (financialYear == '' || financialYear == 0) {
            toastr.warning('select financial year');
            return false;
        }
        if ($('#landlordPAN').hasClass('requir')) {
            return false;
        }
        if ($('.field-validation-valid').text() != '') {
            return false;
        }

        if ($('#HRA_ActualAmt').val() == '' && '@ViewBag.DirectITDeclaration' == 'False' )
        {
            toastr.warning("please enter the actual amount");
            return false;
        }
        if ($('#landlordPAN').val() != '' ) {
            for (var i = 0; i < HouseRentDetails.length; i++) {
                if ($('#landlordPAN').val() == HouseRentDetails[i].Land_Lord_Pan && HourseRentRowID == 0) {
                    toastr.warning("PAN no. already exists" );
                    return false;
                }
            }
        }

        $.ajax({
            type: 'post',
            url: '@Url.Content("~/ITDeclaration/AddHomeRentDetails")',
            data: { Id: HourseRentRowID, year: $('#ddlFinYear').val(), fromdate: StartDate, todate: EndDate, PAN: $('#landlordPAN').val(), address: $('#address').val(), amount: parseFloat($('#Rentamt').val().replace(/,/g, '')), Name: $("#txtname").val(), Employee_ID: Employee_ID, HRA_ActualAmt: ($('#HRA_ActualAmt').val()) == '' ? 0 : $('#HRA_ActualAmt').val() },
            success: function (data) {

                if (data.result == 1) {
                    $('#landlordPAN').removeClass('requir');
                    $(".landlordInfo").tooltip('hide');
                    if (HourseRentRowID == 0) {
                        toastr.success('Successfully Added');
                    }
                    else {
                        toastr.success('Successfully Saved');
                    }
                    $('#btnEditSaveHomeRent').prop('hidden', true);
                    $('#btnAddHomeRent').show();
                    HourseRentRowID = 0;
                    $('.clearcls').val('');
                    gethomeRentDetails(financialYear);


                }
            }
        });
    }

    function gethomeRentDetails(data) {
        debugger

        $.ajax({
            type: 'get',
            async:false,
            url: '@Url.Content("~/ITDeclaration/gethomeRentDetails")',
            data: { year: data, Employee_ID: Employee_ID },
            success: function (data) {
                if (data.success) {
                    getSectionDescriptionDetails();
                    TotalRentAmountDetails = JSON.parse(data.result2);
                    HouseRentDetails = JSON.parse(data.result1);
                    homeRentTableCall(HouseRentDetails);
                    if ($('#ddlFinYear').val() != 0 && $('#ddlFinYear').val() != '') {
                        finalSubmitValidation();
                    }


                    @*if ($('#ddlFinYear').val() != '' && TotalRentAmountDetails.length != 0 && '@ViewBag.DirectITDeclaration' == 'True' && (SectionDetails[0].Submitted_on == null ||  SectionDetails[0].Submitted_on == '')) {
                        if (TotalRentAmountDetails[0].Total_Rental >= 100000) {
                            $('#landlordPAN').addClass('requir');
                            $(".landlordInfo").tooltip('show');

                        }
                    }*@
                }
            }
        });
    }

    function dateRangeValueFormat(date) {
        var d = new Date(date);
        var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul",
                        "Aug", "Sep", "Oct", "Nov", "Dec"];
        var val = (d.getMonth() + 1) + "/" + d.getDate() + "/" + d.getFullYear();
        return val;
    }

    function dateValueFormat(date) {
        var d = new Date(date);
        var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul",
                        "Aug", "Sep", "Oct", "Nov", "Dec"];
        var val = d.getDate() + "-" + months[d.getMonth()] + "-" + d.getFullYear();
        return val;
    }
    function homeRentTableCall(data) {
        if ($.fn.DataTable.isDataTable('#homeRentTable')) {
            $('#homeRentTable').dataTable().fnDestroy();
        }
        homeRentTableDetails = $('#homeRentTable').DataTable({
            "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            "iDisplayLength": 5,
            "bFilter": true,
            // 'scrollX': true,
            'data': data
    ,
            "aoColumns":
        [
          { "mData": "Rented_From", "sTitle": "Rental FromDate", "sType": "date", "sWidth": "20%", "sClass": "text-left", "defaultContent": "<i>Not set</i>" }//0
         , { "mData": "Rented_To", "sTitle": "Rental ToDate", "sType": "date", "sClass": "text-center", "sWidth": "20%", "defaultContent": "<i>Not set</i>" }//1
         , { "mData": "Financial_Year", "sTitle": "Financial Year", "sWidth": "15%", "bVisible": false, "sClass": "text-center", "defaultContent": "<i>Not set</i>" }//2
          , { "mData": "Land_Lord_Name", "sTitle": "Landlord Name", "sWidth": "15%", "sClass": "text-left", "defaultContent": "<i>Not set</i>" }//3
         , { "mData": "Land_Lord_Pan", "sTitle": "Landlord's PAN", "sWidth": "15%", "sClass": "text-left", "defaultContent": "<i>Not set</i>" }//4
         , { "mData": "RENT_ADDRESS", "sTitle": "Address", "sClass": "text-center", "sWidth": "15%", "defaultContent": "<i>Not set</i>" }//5
         , { "data": "Rental_Amount", "sTitle": "Rental Amount(₹)", "sClass": "text-center", "sWidth": "15%", "defaultContent": "<i>Not set</i>" }//6
         , { "data": "Actual_amount", "sTitle": "Actual Amount(₹)", "sClass": "text-center", "sWidth": "15%", "defaultContent": "<i>Not set</i>" }//7
          , { "mData": "Id", "sTitle": "Edit", "sWidth": "5%", "sClass": "text-center", "defaultContent": "<i class='fa fa-edit'></i>" }//8
        ],
            "aoColumnDefs": [
               {
                   "aTargets": [0, 1],
                   "mRender": function (data, type, row) {
                       if (data == null || data == '') {
                           return '-';
                       }
                       else {
                           return dateValueFormat(data);
                       }
                   }
               }
               ,
        {
            "aTargets": [6],
            "mRender": function (data, type, row) {
                //return parseFloat(data.replace(/,/g, ''));
                return data.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            }
        }
           ,
                  {
                      "aTargets": [7],
                      "mRender": function (data, type, row) {
                          if (data == null) {
                              return '0';
                          }
                          else {
                              return data;
                          }
                      }
                  }
                  ,
                  {
                      "aTargets": [8],
                      "mRender": function (data, type, row) {
                          return '<i onclick="editHomeRentCall(this)" class="fa fa-edit"></i>';
                      }
                  }
            ],
            "footerCallback": function (row, data, start, end, display) {
                var api = this.api(), data;

                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ?
                        i.replace(/[\$,]/g, '') * 1 :
                        typeof i === 'number' ?
                        i : 0;
                };

                declaredTotal = api
                .column(6)
                .data()
                .reduce(function (a, b) {
                    return parseFloat(intVal(a) + intVal(b)).toFixed(2);
                }, 0);

                $('#declaredtotal').text(declaredTotal.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));

                actualTotal = api
               .column(7)
               .data()
               .reduce(function (a, b) {
                   return parseFloat(intVal(a) + intVal(b)).toFixed(2);
               }, 0);

                $('#actualtotal').text(actualTotal.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
            }
        });
    }
    function getSummaryTabDetails(data) {
        $.ajax({
            type: 'get',
            url: '@Url.Content("~/ITDeclaration/getSummaryTabDetails")',
            data: { year: data },
            success: function (data) {
                if (data.success) {
                    SummaryDetails = JSON.parse(data.result1);
                    if (SummaryDetails.length != 0) {
                        $('#summTotalHRA').val(SummaryDetails[0].Total_Rental);
                        $('#summPrincipalPaid').val(SummaryDetails[0].PRINCIPAL_PAID_ON_LOAN);
                        $('#summInterestPaid').val(SummaryDetails[0].INTEREST_PAID_ON_LOAN);
                        $('#summTotalSubmitted').val(SummaryDetails[0].Submitted_amount);
                        $('#summTotalActual').val(SummaryDetails[0].Approved_Amount);
                    }


                }
            }
        });
    }

    function editHomeRentCall(thisval) {
        debugger

        $('#btnEditSaveHomeRent').prop('hidden', false);
        $('#btnAddHomeRent').hide();

        if ('@ViewBag.DirectITDeclaration' == 'True') {
            $('#HRA_ActualAmt').prop('disabled', true);
        }
        else {
            $('#HRA_ActualAmt').prop('disabled', false);
        }

        rowData = $('#homeRentTable').DataTable().row(thisval.closest('tr')).data();
        HourseRentRowID = rowData.Id;
        $('#landlordPAN').val(rowData.Land_Lord_Pan);
        $('#txtname').val(rowData.Land_Lord_Name);
        $('#address').val(rowData.RENT_ADDRESS);
        $('#Rentamt').val(rowData.Rental_Amount);
        $('#daterangefilter').daterangepicker({ startDate: dateRangeValueFormat(rowData.Rented_From), endDate: dateRangeValueFormat(rowData.Rented_To) });
    }



    function getSectionDescriptionDetails() {
        $.ajax({
            type: 'get',
            async:false,
            url: '@Url.Content("~/ITDeclaration/getSectionDescriptionDetails")',
            data: { year: ($('#ddlFinYear').val()) == '' ? 0 : $('#ddlFinYear').val() , Employee_ID:Employee_ID},
            success: function (data) {
                if (data.success) {
                    SectionDetails = JSON.parse(data.result1);
                    DescriptionDetails = JSON.parse(data.result2);

                    formTableCall(SectionDetails);
                    for(var i=0;i<SectionDetails.length;i++)
                    {
                        if(SectionDetails[i].Submitted_on!='' && SectionDetails[i].Submitted_on!=null )
                        {
                            tempSubmittedOn = true;
                            tempSubmittedDate = SectionDetails[i].Submitted_on;
                        }
                        if (SectionDetails[i].Approved_On != '' && SectionDetails[i].Approved_On != null) {
                            tempApprovedOn = true;
                            tempApprovedDate = SectionDetails[i].Approved_On;
                        }

                    }
                    for (var i = 0; i < DescriptionDetails.length; i++) {
                        if (DescriptionDetails[i].Submitted_on != '' && DescriptionDetails[i].Submitted_on != null) {
                            tempSubmittedOn = true;
                            tempSubmittedDate = DescriptionDetails[i].Submitted_on;
                        }
                        if (DescriptionDetails[i].Approved_On != '' && DescriptionDetails[i].Approved_On != null) {
                            tempApprovedOn = true;
                            tempApprovedDate = DescriptionDetails[i].Approved_On;
                        }
                    }


                }
            }
        });
    }
    function finalSubmitValidation() {

        var Selectedyear = []
        var financialYear = $('#ddlFinYear').val();
        Selectedyear = CurrYear.filter(m => m.Id = financialYear);
        var lastSubmit = Selectedyear[0].Last_Submission_Date;
        //var curr_date = new Date();
        //if (curr_date > new Date(lastSubmit) || (SectionDetails[0].Approved_On != null && SectionDetails[0].Approved_On != '')) {
        //    toastr.warning("Proof submission time has closed/your form has already been approved by Admin");
        //    return false;
        //}
        if (('@ViewBag.DirectITDeclaration' == 'True') && (tempSubmittedOn==false) && (lastSubmit != undefined && lastSubmit != null && lastSubmit != '')) {
            $('#formSubmitDate').html('Last date of submission: ' + '<span>' + dateValueFormat(lastSubmit) + '</span>');
        }



        if ((tempSubmittedOn == true || tempApprovedOn==true) && '@ViewBag.DirectITDeclaration' == 'True') {
            $('.admincls,.disableSubAmtcls ').prop('disabled', true);
            $('#btnAddHomeRent,#btnAddHomeLoan,#btnFinalSubmit,#btnAddOtherIncome').hide();
            homeRentTableDetails.column(8).visible(false);    // column-8 -> edit
            itFormTableDetails.column(5).visible(false);      // column-5 -> submit

        }
        if ((tempSubmittedOn == true || tempApprovedOn == true))
        {
            $('#formSubmitDate').html('Form Submmitted on: '+'<span>' + dateValueFormat(tempSubmittedDate) + '</span>');
        }
        if (tempApprovedOn==true && '@ViewBag.DirectITDeclaration' == 'False') {
            $('.admincls,.disableActualAmtcls ').prop('disabled', true);
            $('#btnAddHomeRent,#btnAddHomeLoan,#btnFinalSubmit,#btnAddOtherIncome').hide();
            homeRentTableDetails.column(8).visible(false);    // column-8 -> edit
            itFormTableDetails.column(5).visible(false);      // column-5 -> submit

        }

        if (((tempSubmittedOn == true || tempApprovedOn == true)) && '@ViewBag.DirectITDeclaration' == 'False')
        {
            $('.btnadminbeforeapprovecls').hide();
        }


    }
    function formTableCall(data) {
        if ($.fn.DataTable.isDataTable('#itFormTable')) {
            $('#itFormTable').dataTable().fnDestroy();
        }
        itFormTableDetails = $('#itFormTable').DataTable({
            "lengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
            "iDisplayLength": 5,
            "bFilter": true,
            // 'scrollX': true,
            'data': data
    ,
            "aoColumns":
        [
           { "mData": "SECTION", "sTitle": "Section", "sWidth": "15%", "sClass": "text-left", "defaultContent": "<i>Not set</i>" }//0
         , { "mData": "DESCRIPTION", "sTitle": "Description", "sWidth": "20%", "sClass": "text-left", "defaultContent": "<i>Not set</i>" }//1
         , { "mData": "NOTES", "sTitle": "Notes", "sClass": "text-center", "sWidth": "5%", "defaultContent": "<i>Not set</i>" }//2
         , { "mData": "MAX_LIMIT", "sTitle": "Maximum Limit(₹)", "sClass": "text-center", "sWidth": "15%", "defaultContent": "<i>Not set</i>" }//3
         , { "data": "SECTION", "sTitle": "View", "sClass": "text-center", "sWidth": "15%", "defaultContent": "<i>Not set</i>" }//4
         , { "mData": "SECTION", "sTitle": "Submit", "sWidth": "15%", "sClass": "text-center", "defaultContent": "<i>Not set</i>" }//5
         , { "mData": "Submitted_amount", "sTitle": "Total Declared Amount(₹)", "sWidth": "15%", "sClass": "text-center", "defaultContent": "<i>Not set</i>" }//6
         , { "mData": "Approved_Amount", "sTitle": "Total Actual Amount(₹)", "sWidth": "15%", "sClass": "text-center", "defaultContent": "<i>Not set</i>" }//7
         , { "mData": null, "sTitle": "Upload files", "sWidth": "15%", "sClass": "text-center", "bVisible": false, "defaultContent": "<i>Not set</i>" }//8

        ],
            'aoColumnDefs':
              [
                  {
                      "aTargets": [2],
                      "mRender": function (data, type, row) {
                          if (data == null || data == '') {
                              data = 'none';
                              return '<i class="fa fa-info-circle"  title="' + data + '" onmouseover="setTooltip()"></i>';
                          }
                          else {
                              return '<i class="fa fa-info-circle"  title="' + data + '" onmouseover="setTooltip()"></i>';
                          }
                      }
                  }
                  ,
                  {
                      "aTargets": [4],
                      "mRender": function (data, type, row) {
                          return '<img src="@Url.Content("~/Content/images/chevron-down.png")"  id="viewDetails'+row.SECTION+'"  onclick="ViewSubSectionDetails(this)" style="cursor:pointer;" />'
                      }
                  }
                  ,
                  {
                      "aTargets": [5],
                      "mRender": function (data, type, row) {
                          return '<span   class="badge" style="background-color:#2d8830ad;" onclick="SubmitSectionAmt(this)">Save</span>'
                      }
                  }
                   ,
                  {
                      "aTargets": [6],
                      "mRender": function (data, type, row) {
                          if (row.Submitted_amount == null || row.Submitted_amount == '') {
                              return '<label id="totalDeclaredAmt' + row.SECTION + '" >0</label>';
                          }
                          else {
                              return '<label id="totalDeclaredAmt' + row.SECTION + '" >' + (row.Submitted_amount).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") + '</label>';
                          }
                      }
                  }
                  ,
              {
                  "aTargets": [7],
                  "mRender": function (data, type, row) {
                      if (row.Approved_Amount == null || row.Approved_Amount == '') {
                          return '<label id="totalActualAmt' + row.SECTION + '" >0</label>';
                      }
                      else {
                          return '<label id="totalActualAmt' + row.SECTION + '" >' + (row.Approved_Amount).toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,") + '</label>';
                      }
                  }
              }

                   ,
                  {
                      "aTargets": [3],
                      "mRender": function (data, type, row) {
                          if (data == 0 || data == null) {
                              return '-'
                          }
                          else {
                              return data.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
                          }


                      }
                  }
              ]
            ,
            "footerCallback": function (row, data, start, end, display) {
                var api = this.api(), data;

                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ?
                        i.replace(/[\$,]/g, '') * 1 :
                        typeof i === 'number' ?
                        i : 0;
                };

                declaredTotal = api
                .column(6)
                .data()
                .reduce(function (a, b) {
                    return parseFloat(intVal(a) + intVal(b)).toFixed(2);
                }, 0);

                $('#ITdeclaredtotal').text(declaredTotal.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));

                actualTotal = api
               .column(7)
               .data()
               .reduce(function (a, b) {
                   return parseFloat(intVal(a) + intVal(b)).toFixed(2);
               }, 0);

                $('#ITactualtotal').text(actualTotal.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
            }
        });

    }


    function ViewSubSectionDetails(CurrentElement) {
        debugger

        var financialYear = $('#ddlFinYear').val();
        if (financialYear == '' || financialYear == 0) {
            toastr.warning('select financial year');
            return false;
        }

        rowData = $('#itFormTable').DataTable().row(CurrentElement.closest('tr')).data();
        CurrSection = rowData.SECTION;

        if (CurrSection == "80GG") {
            $("ul.getactivetab li a.active").removeClass("active");
            $("div.tab-content div.active").removeClass("active");
            $("ul.getactivetab li a.HouseRentDetailsLink").addClass("active");
            $("div.tab-content div.Content_HouseRent").addClass("active");
            return false;
        }

        var nTr = CurrentElement.parentNode.parentNode;
        if ($("#itFormTable").dataTable().fnIsOpen(PreviousTr) && PreviousTr != nTr) {
            $("#itFormTable").dataTable().fnClose(PreviousTr);
            PreviousTd.src = "@Url.Content("~/Content/images/chevron-down.png")";
        }
        if ($("#itFormTable").dataTable().fnIsOpen(nTr)) {
            $("#itFormTable").dataTable().fnClose(nTr);
            CurrentElement.src = "@Url.Content("~/Content/images/chevron-down.png")";
        } else {
            CurrentElement.src = "@Url.Content("~/Content/images/chevron-up.png")";
            $("#itFormTable").dataTable().fnOpen(nTr, mapDetails(DescriptionDetails), 'details');
            PreviousTr = nTr;
            PreviousTd = CurrentElement;
        }


        if ((tempSubmittedOn == true || tempApprovedOn == true) && '@ViewBag.DirectITDeclaration' == 'True') {
            $('.disableSubAmtcls ').prop('disabled', true);
        }
        if (tempApprovedOn == true && '@ViewBag.DirectITDeclaration' == 'False') {
            $('.disableActualAmtcls ').prop('disabled', true);
        }
    }

    function LandlordTooltip() {
        $(".landlordInfo").tooltip({ placement: "top" });
    }

    function setTooltip() {
        $(".fa-info-circle").tooltip({ placement: "right" })
    }

    function mapDetails(data) {
        var sOut = '<table class="table MTS_Table table-bordered table-condensed table-responsive " style="margin-bottom: 1px!important;;width:100%;" border="0">';
        if (data == null || data == undefined || data.length == 0) {
            sOut += '<tr><th class="text-center">No data</th></tr>';
        } else {
            sOut += '<thead >';
            sOut += '<tr role="row" >';
            sOut += '<th style="width:20%" class="text-center">Sub-Section</th>';
            sOut += '<th style="width:20%" class="text-center">Description</th>';
            sOut += '<th style="width:5%" class="text-center">Notes</th>';
            sOut += '<th style="width:20%" class="text-center">Maximum Limit</th>';
            sOut += '<th style="width:20%" class="text-center">Declared Amount</th>';
            sOut += '<th style="width:20%" class="text-center">Actual Amount</th>';
            sOut += '<th style="width:20%" class="text-center">Proof Upload</th>';
            //if (data == null || data[0].Employee_id != null) {
            //    sOut += '<th style="width:15%" class="text-center">Unassign</th>';
            //} else {
            //    sOut += '<th style="width:15%" class="text-center">Assign</th>';
            //}
            sOut += "</tr>";
            sOut += '</thead>';
            sOut += '<tbody>';
            for (var i = 0; i < data.length; i++) {
                if (data[i].SECTION == CurrSection) {
                    sOut += "<tr>";
                    sOut += '<td style="width:20%" class="text-left"><label class="subSection' + data[i].SECTION + '" id="subSection' + i + '" >' + data[i].SUB_SECTION + '</label></td>';
                    sOut += '<td style="width:20%" class="text-left">' + data[i].DESCRIPTION + '</td>';
                    if (data[i].NOTES == null || data[i].NOTES == '') {
                        var tempData = 'none';
                        // sOut += '<td style="width:20%" class="text-center">-</td>';
                        sOut += '<td style="width:5%" class="text-center"><i class="fa fa-info-circle "  title="' + tempData + '" onmouseover="setTooltip()"></i></td>';

                    }
                    else {
                        var tempData = data[i].NOTES;
                        // sOut += '<td style="width:20%" class="text-center">' + data[i].NOTES + '</td>';

                        sOut += '<td style="width:5%" class="text-center"><i class="fa fa-info-circle "  title="' + tempData + '" onmouseover="setTooltip()"></i></td>';
                    }
                    if (data[i].MAX_LIMIT == 0 || data[i].MAX_LIMIT == null) {
                        sOut += '<td style="width:20%" class="text-center">-</td>';
                    }
                    else {
                        sOut += '<td style="width:20%" class="text-center">' + data[i].MAX_LIMIT + '</td>';
                    }
                    // if (data[i].Submitted_amount == '' || data[i].Submitted_amount == null) {
                    if ('@ViewBag.DirectITDeclaration' == 'True') {
                        sOut += '<td style="width:20%" class="text-center"><input class="subAmt' + data[i].SECTION + '  disableSubAmtcls formatNumbercls" id="subAmt' + i + '" type="number" value="' + data[i].Submitted_amount + '" onchange="validationAmt(' + data[i].MAX_LIMIT + ',event)"  /></td>'
                    }
                    else {
                        sOut += '<td style="width:20%" class="text-center"><input class="subAmt' + data[i].SECTION + ' disableSubAmtcls formatNumbercls" id="subAmt' + i + '" type="number"  value="' + data[i].Submitted_amount + '"  onchange="validationAmt(' + data[i].MAX_LIMIT + ',event)" disabled  /></td>'
                    }
                    if ('@ViewBag.DirectITDeclaration' == 'True') {
                        sOut += '<td style="width:20%" class="text-center"><input  class="ActualAmt' + data[i].SECTION + ' disableActualAmtcls formatNumbercls" id="ActualAmt' + i + '"  value="' + data[i].Approved_Amount + '" onchange="validationAmt(' + data[i].MAX_LIMIT + ',event)" disabled type="number" /></td>';
                    }
                    else {
                        sOut += '<td style="width:20%" class="text-center"><input  class="ActualAmt' + data[i].SECTION + ' disableActualAmtcls formatNumbercls" id="ActualAmt' + i + '"  value="' + data[i].Approved_Amount + '" onchange="validationAmt(' + data[i].MAX_LIMIT + ',event)"  type="number" /></td>';
                    }
                    sOut += '<td style="width:20%" class="text-center"><i class="fa fa-upload btnUploadCls"></i></td>';

                    sOut += "</tr>";

                    @*if ('@ViewBag.DirectITDeclaration' == 'True') {
                        $('.disableSubAmtcls').prop('disabled', true);
                    }
                    else
                    {
                        $('.disableSubAmtcls').prop('disabled', false);
                     //   $('#disableSubAmtcls').prop('disabled', false);
                    }*@

                }
            }
            sOut += '</tbody>';
        }
        sOut += '</table>';


        return sOut;
    }
    function SubmitSectionAmt(thisval) {

        var financialYear = $('#ddlFinYear').val();
        if (financialYear == '' || financialYear == 0) {
            toastr.warning('select financial year');
            return false;
        }
        var nTr = thisval.parentNode.parentNode;
        if (!$("#itFormTable").dataTable().fnIsOpen(nTr)) {
            toastr.warning('Open Subsection View before submit');
        }

        var sum1 = 0;
        var sum2 = 0;
        var tempsubAmt = 0;
        var tempActualAmt = 0;
        var tempActualAmtList = '';
        var tempsubAmtList = '';
        var tempSection;
        var tempSubSectionList = '';

        debugger
        rowData = $('#itFormTable').DataTable().row(thisval.closest('tr')).data();


        for (var i = 0; i < $('.subAmt' + rowData.SECTION + '').length; i++) {
            tempsubAmt = $('#' + $('.subAmt' + rowData.SECTION + '')[i].id).val();
            if (tempsubAmt == '') {
                tempsubAmt = 0;
            }
            else {
                tempsubAmt = parseFloat($('#' + $('.subAmt' + rowData.SECTION + '')[i].id).val());
            }
            tempActualAmt = $('#' + $('.ActualAmt' + rowData.SECTION + '')[i].id).val();
            if (tempActualAmt == '') {
                tempActualAmt = 0;
            }
            else {
                tempActualAmt = parseFloat($('#' + $('.ActualAmt' + rowData.SECTION + '')[i].id).val());
            }
            tempSection = rowData.SECTION;
            tempsubAmtList += tempsubAmt + ',';
            tempActualAmtList += tempActualAmt + ',';
            tempSubSectionList += $('#' + $('.subSection' + rowData.SECTION + '')[i].id).text() + ',';
         
                sum1 = sum1 + tempsubAmt;
                sum2 = sum2 + tempActualAmt
          
        }
        if ((sum1 > rowData.MAX_LIMIT || sum2 > rowData.MAX_LIMIT) && rowData.MAX_LIMIT!=0) {
            toastr.warning('Exceeds Maximum Limit');
            return false;
        }
        else {
            tempsubAmtList = tempsubAmtList.substring(0, tempsubAmtList.length - 1);
            tempActualAmtList = tempActualAmtList.substring(0, tempActualAmtList.length - 1);
            tempSubSectionList = tempSubSectionList.substring(0, tempSubSectionList.length - 1);

            $.ajax({
                type: 'post',
                url: '@Url.Content("~/ITDeclaration/saveITFormDetails")',
                data: { emp_IT_id: (rowData.EMP_IT_ID) == null ? 0 : rowData.EMP_IT_ID, tempSection: tempSection, tempSubSectionList: tempSubSectionList, tempsubAmtList: tempsubAmtList, tempActualAmtList: tempActualAmtList, totalDeclaredAmt: sum1, totalActualAmt: sum2, year: financialYear, Employee_ID: Employee_ID },
                success: function (data) {
                    debugger
                    if (data.result == 1) {
                       // getSectionDescriptionDetails();
                        // getHomeLoanDetails();
                        $('#ddlFinYear').trigger('change');
                        toastr.success('Successfully Saved');
                       
                    }
                }
            });
        }

    }


    function onchangeTotalAmount(section) {
        var sum1 = 0;
        var sum2 = 0;
        var tempsubAmt;
        var tempActualAmt;
        //  rowData = $('#itFormTable').DataTable().row(thisval.closest('tr')).data();
        for (var i = 0; i < $('.subAmt' + section + '').length; i++) {
            tempsubAmt = $('#' + $('.subAmt' + section + '')[i].id).val();
            if (tempsubAmt == '') {
                tempsubAmt = 0;
            }
            else {
                tempsubAmt = parseFloat($('#' + $('.subAmt' + section + '')[i].id).val());
            }
            tempActualAmt = $('#' + $('.ActualAmt' + section + '')[i].id).val();
            if (tempActualAmt == '') {
                tempActualAmt = 0;
            }
            else {
                tempActualAmt = parseFloat($('#' + $('.ActualAmt' + section + '')[i].id).val());
            }
            //    tempSection = rowData.SECTION;
            sum1 += tempsubAmt;
            sum2 += tempActualAmt;

        }
        $('#totalDeclaredAmt' + section).text(sum1.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
        $('#totalActualAmt' + section).text(sum2.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
    }

    function validationAmt(maxlimit, e) {
        debugger
        onchangeTotalAmount(CurrSection);
        if (maxlimit != 0) {
            if (parseFloat(e.currentTarget.value) > parseFloat(maxlimit)) {
                $('#' + e.currentTarget.id).val(parseFloat(maxlimit));
                toastr.warning('Maximum Limit Exceeding...!');
            }
        }

    }


    function finalSubmit() {
        var emp_IT_ID = (SectionDetails[0].EMP_IT_ID) == null ? 0 : SectionDetails[0].EMP_IT_ID;

        bootbox.confirm('Are you sure do you want to Submit your IT-Declaration details?', function (result) {
            if (result) {

                $.ajax({
                    type: 'post',
                    url: '@Url.Content("~/ITDeclaration/FinalSubmitITDeclaration")',
                    data: { emp_IT_ID: emp_IT_ID, DirectITDeclaration: '@ViewBag.DirectITDeclaration' },
                    success: function (data) {
                        debugger
                        if (data.result == 1) {
                            toastr.success('Successfully Submitted');
                            getSectionDescriptionDetails();
                            setTimeout(function () {
                                location.reload();
                                $("html, body").animate({ scrollTop: $('.mainContent').position().top }, "fast");
                            }, 2000);
                        }
                    }
                });

            }
        });
    }

</script>
