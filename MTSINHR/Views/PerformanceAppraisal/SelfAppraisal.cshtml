@{
    ViewBag.Title = "SelfAppraisal";
}
@*<link href="~/Content\css\style.css" rel="stylesheet" />*@

<link href="~/Content/css/range.css" rel="stylesheet" />

<link rel="stylesheet" href="~/Content/css/summary.css">

<script src="~/Scripts/circles.js"></script>

<style>
    .pad-all20 {
        padding-top: 20px;
        padding-bottom: 20px;
        padding-left: 20px;
        padding-right: 20px;
    }

    .commentBox {
        background-color: #d4dde67a;
    }
    /*.popover {
        will-change: transform;
        position: relative;
        transform: translate3d(1004px, 144px, 0px);
        top: 0px;
        left: 0px;
    }*/
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .commentList {
        padding: 0;
        list-style: none;
        max-height: 200px;
        overflow: auto;
    }

        .commentList li {
            margin: 0;
            margin-top: 10px;
        }

            .commentList li > div {
                display: table-cell;
            }

    .commenterImage {
        width: 30px;
        margin-right: 5px;
        height: 100%;
        float: left;
    }

        .commenterImage img {
            width: 100%;
            border-radius: 50%;
        }

    .commentText p {
        margin: 0;
    }

    .sub-text {
        color: #aaa;
        font-family: verdana;
        font-size: 11px;
    }

    .smFBFntSize {
        font-size: 20px;
    }

    .lgFBFntSize {
        font-size: 30px;
    }

    .btnclose {
        margin-right: 10px;
    }

    .app-content {
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
    }

    .update-info {
        font-weight: 400;
        font-style: italic;
        font-size: 13px;
        margin-right: 10px;
    }

        .update-info span {
            font-weight: bold;
        }

    .nav-tabs {
        border: none;
    }

    .recent-info {
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
    }

    .m-top-10 {
        margin-top: 10px;
    }

    .commentBox {
        position: relative;
    }

    .commentClose {
        position: absolute;
        top: 20px;
        right: 10px;
    }

    .badge-txt {
        padding: 10px;
        background-color: #3d79b5;
    }

    #empDetailsDiv {
        margin-top: 10px;
    }
</style>
<div class="card" id="self_appraisal_content">
    <div class="card-header ">
        <div class="p-t-5 changeName text-center">
            Employee Performance Evaluation<span id="AppraisalDescription"></span>
            <div class="text-center col-lg-12 row" id="empDetailsDiv">
                <div class="col-lg-4 text-center">
                    <h5 class="badge badge-primary text-right badge-txt">
                        Employee Code:
                        <span id="empCode"></span>
                    </h5>
                </div>
                <div class="col-lg-4 text-center">
                    <h5 class="badge badge-primary text-right badge-txt">
                        Employee Name:
                        <span id="empName"></span>
                    </h5>
                </div>
                <div class="col-lg-4 text-center">
                    <h5 class="badge badge-primary text-right badge-txt">
                        Employee Designation:
                        <span id="empDesg"></span>
                    </h5>
                </div>
            </div>
        </div>
    </div>
    <div class="card-body">
        <div class="recent-info">

            <i class="fa fa-info-circle p-r-10 clr-99 pull-right m-top-10" data-toggle="popover" data-placement="left" data-html="true" data-content="" data-original-title="" title="" id="attendanceInfo"></i>

            <span class="update-info pull-right m-top-10"></span>

            <ul class="nav nav-tabs getactivetab" id="">
                <li class="nav-item">
                    <a data-id="1" class="nav-link active dashboard_nav_active KraDetailsLink" id="KraDetailsLink" data-toggle="tab" href="#Content_KRA">KRA</a>
                </li>
                <li class="nav-item">
                    <a data-id="2" class="nav-link dashboard_nav_active DashboardTableLink" id="DashboardTableLink" data-toggle="tab" href="#Content_Skills">Skill</a>
                </li>
                <li class="nav-item">
                    <a data-id="3" class="nav-link dashboard_nav_active EmployeeAssignedAssetsListLink" id="EmployeeAssignedAssetsListLink" data-toggle="tab" href="#Content_Summary">Summary</a>
                </li>
                <li class="nav-item managerCommends">
                    <a data-id="4" class="nav-link dashboard_nav_active ManagerCommends" id="ManagerCommends" data-toggle="tab" href="#Manager_Commends">Feedback</a>
                </li>

            </ul>
        </div>

        <div class="tab-content" id="tabContentDiv" hidden>

            <div class="tab-pane active content_kra" id="Content_KRA">
                <div class="row col-lg-12">
                    <div id="KRARatingoutoffive" class="col-lg-4" style="text-align:center"></div>
                    <div id="Evaluator_KRARatingoutoffive" class="col-lg-4" style="text-align:center"></div>
                    <div id="Final_Evaluator_KRARatingoutoffive" class="col-lg-4" style="text-align:center"></div>
                </div>


                <div class="card-body">
                    <div class="col-lg-12 pad-all20 app-content" style="background-color:#fff;">
                        <div class="nodatacls"><span class="d-block p-2 bg-info  text-center  text-white">There is no KRA Assigned ...!</span></div>
                        <div class="admincls"><div class="row col-lg-12 "><div class="col-lg-1"><b>SL.NO</b></div><div class="col-lg-3"><b>Description</b></div><div class="col-lg-2"><b>Weightage</b></div><div class="col-lg-2 "><b>Self Rating</b></div><div class="col-lg-2 nomanagercls"><b>Manager Rating</b></div><div class="col-lg-2 noadmincls"><b>Final Rating</b></div></div><br /></div>

                        <div class="managercls"><div class="row col-lg-12 "><div class="col-lg-1"><b>SL.NO</b></div><div class="col-lg-5"><b>Descriptions</b></div><div class="col-lg-2"><b>Weightage</b></div><div class="col-lg-2 "><b>Self Rating</b></div><div class="col-lg-2 nomanagercls"><b>Manager Rating</b></div></div><br /></div>
                        <div class="empcls"><div class="row col-lg-12 "><div class="col-lg-2"><b>SL.NO</b></div><div class="col-lg-4"><b>Descriptions</b></div><div class="col-lg-3"><b>Weightage</b></div><div class="col-lg-3 "><b>Self Rating</b></div></div><br /></div>

                        <div id="KRA_quest"></div>

                    </div>
                    <div class="col-lg-12" style="margin-top:20px;">
                        <button class="btn btn-primary adminbtn text-right pull-right btn btn-success" id="btnNextTab" onclick="saveQuestEmployeeWeightage(3,'KRA')">Save & Next</button>
                        <button class="btn btn-primary btn-success managercls managerbtn pull-right" id="btnNextTab" onclick="saveQuestEmployeeWeightage(2,'KRA')">Save & Next</button>
                        <button class="btn-primary empcls empbtn pull-right btn btn-success" id="btnNextTab" onclick="saveQuestEmployeeWeightage(1,'KRA')">Save & Next</button>
                        <button class="btn btn-primary btnclose pull-right" id="btnclose" onclick="closeTab()">Close</button>

                    </div>
                </div>
            </div>
            <div class="tab-pane content_skills" id="Content_Skills">
                <div class="row col-lg-12">
                    <div id="SkillsRatingoutoffive" class="col-lg-4" style="text-align:center"></div>
                    <div id="Evaluator_SkillsRatingoutoffive" class="col-lg-4" style="text-align:center"></div>
                    <div id="Final_Evaluator_SkillsRatingoutoffive" class="col-lg-4" style="text-align:center"></div>
                </div>
                <div class="card-body">
                    <div class="col-lg-12 pad-all20 app-content" style="background-color:#fff;">
                        <div class="nodatacls"><span class="d-block p-2 bg-info  text-center  text-white">There is no Skills Assigned for you...!</span></div>
                        <div class="admincls"><div class="row col-lg-12 "><div class="col-lg-1"><b>SL.NO</b></div><div class="col-lg-3"><b>Description</b></div><div class="col-lg-2"><b>Weightage</b></div><div class="col-lg-2 "><b>Self Rating</b></div><div class="col-lg-2 nomanagercls"><b>Manager Rating</b></div><div class="col-lg-2 noadmincls"><b>Final Rating</b></div></div><br /></div>

                        <div class="managercls"><div class="row col-lg-12 "><div class="col-lg-1"><b>SL.NO</b></div><div class="col-lg-5"><b>Descriptions</b></div><div class="col-lg-2"><b>Weightage</b></div><div class="col-lg-2 "><b>Self Rating</b></div><div class="col-lg-2 nomanagercls"><b>Manager Rating</b></div></div><br /></div>
                        <div class="empcls"><div class="row col-lg-12 "><div class="col-lg-2"><b>SL.NO</b></div><div class="col-lg-4"><b>Descriptions</b></div><div class="col-lg-3"><b>Weightage</b></div><div class="col-lg-3 "><b>Self Rating</b></div></div><br /></div>
                        <div id="Skill_quest"></div>
                    </div>
                    <div class="col-lg-12" style="margin-top:20px;">

                        <button class="btnbackcls btn btn-primary pull-left" onclick="goBackTab()" id="btnback">Back</button>
                        <button class="adminbtn btn btn-success pull-right" id="btnNextTab" onclick="saveQuestEmployeeWeightage(3,'Skills')">Save & Next</button>
                        <button class="managerbtn managercls btn btn-success pull-right" id="btnNextTab" onclick="saveQuestEmployeeWeightage(2, 'Skills')">Save & Next</button>
                        <button class="btn btn-success empcls empbtn pull-right " id="btnNextTab" onclick="saveQuestEmployeeWeightage(1, 'Skills')">Save & Next</button>
                        <button class="btn btn-primary btnclose pull-right" id="btnclose" onclick="closeTab()">Close</button>
                    </div>
                </div>
            </div>
            <div class="tab-pane content_summary" id="Content_Summary">

                <div class="row col-lg-12">
                    <div id="performanceDiv" class="col-lg-4" style="text-align:left"></div>
                    <div id="potentialDiv" class="col-lg-4" style="text-align:center"></div>
                    <div id="OverAllRating" class="col-lg-4" style="text-align:right"></div>
                </div>
                <div class="card-body">
                    @*<div class="row col-lg-6 alert alert-success" role="alert">
                        This is a success alert—check it out!
                        </div>*@
                    <div id="CompletionTimeDiv"></div>
                    <div class="row col-lg-12 form-group t-p-10" id="feedBackSummary" style="background: #e6e7e87a;height: 60px;">
                        <div class="row col-lg-12 t-p-20">
                            <div class="col-lg-4 text-center p-t-15" style="color: #0069d9"><b>FeedBack</b></div>

                            <div class="col-lg-8 text-left p-t-15">
                                <label>Reward</label>&nbsp;<span class="clsFB spanedit smFBFntSize fa fa-star" id="reward"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <label>Positive</label>&nbsp;<span class="clsFB spanedit smFBFntSize fa fa-thumbs-o-up" id="positive"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <label>Observation</label>&nbsp;<span class="clsFB spanedit smFBFntSize fa fa-eye m-l-10" id="observation"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <label>Training</label>&nbsp;<span class="clsFB spanedit smFBFntSize fa fa-certificate" id="training"></span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <label>Negative</label>&nbsp;<span class="clsFB spanedit smFBFntSize fa fa-thumbs-o-down" id="negative"></span>
                            </div>

                        </div>
                    </div>


                    <div class="col-lg-12 pad-all20 app-content" style="background-color:#fff;">
                        <div class="nodatacls"><span class="d-block p-2 bg-info  text-center nodatacls text-white">There is no Summary Assigned for you...!</span></div>

                        <div id="Summary_quest"></div>
                    </div>
                    <div class="col-lg-12" style="margin-top:20px;">

                        <button class="btn btn-primary btnbackcls pull-left" onclick="goBackTab()" id="btnback">Back</button>
                        <button class="btn btn-success admincls adminbtn pull-right" onclick="submitEmployeeSummary(3)">Submit Appraisal</button>
                        <button class="btn btn-success managercls managerbtn pull-right" id="btnNextTab" onclick="submitEmployeeSummary(2)">Submit Appraisal</button>
                        <button class="btn btn-success empcls empbtn pull-right" id="btnNextTab" onclick="submitEmployeeSummary(1)">Submit Appraisal</button>
                        <button class="btn btn-primary btnclose pull-right" id="btnclose" onclick="closeTab()">Close</button>
                    </div>
                </div>
            </div>

            <div class="tab-pane manager_commends" id="Manager_Commends">
                <br />
                <div class="noFeedback"><span class="d-block p-2 bg-info  text-center  text-white">No Feedback</span></div>
                <div class="card-body feedbackSection">

                    <div class="row">
                        <div class="col-lg-12">
                            <ul class="commentList feedbacklist"></ul>
                        </div>
                    </div>
                    <div class="row feedbackenterBox">
                        <div class="col-lg-8">
                            <!--<input class="form-control" type="text" id="feedbackinput" placeholder="Your Feedback" />-->
                            <textarea id="feedbackinput" class="form-control" rows="3" cols="10"></textarea>
                        </div>
                        <div class="col-lg-2 pull-right">
                            <button class="btn btn-success btnAdd feedbackComment" id="btnAdd" style="margin-top: 30px;" onclick="AddFeedback()">Post</button>
                        </div>
                    </div>
                    <div class="col-lg-12 col-md-12" style="margin-top:20px;">
                        <button class="btn btn-primary btnbackcls pull-left" onclick="goBackTab()" id="btnback">Back</button>
                        <button class="btn btn-primary btnfeedback pull-right" id="btnclose" onclick="closeTab()">Close</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .popover {
        background: #3d79b5 !important;
    }

    .popover-body {
        color: white;
    }

    .popover.bs-popover-left .arrow::after {
        border-left-color: #3d79b5;
    }
</style>
<script>
    var empDetails = [];
    var feedbackComments = [];
    var typeList = [];
    var descriptionList = [];
    var KRA_quest = '';
    var Skill_quest = '';
    var Summary_quest = '';
    var EmployeeWeightageValueList = [];
    var EmployeeWeightageIdList = [];
    var sessionrole;
    var isSelfDirectAppraisalPage;
    var MaximumRating = 0;
    var EMPLOYEE_ID = 0;
    var APPRAISAL_PROCESS_PERIOD_ID = 0;
    var commenter = '';
    var empRatings = [];
    var feedBackCategory = '';
    var flagKra = false;
    var flagSkill = false;
    //var appraisal_description;
    $(document).ready(function () {
        //$('[data-toggle="popover"]').popover({
        //    trigger: 'hover'
        //})

        $('.nodatacls,.noFeedback').hide();
        sessionrole = '@Session["RoleId"].ToString()';
        isSelfDirectAppraisalPage = '@ViewBag.IsSelfDirectAppraisalPage';
        MaximumRating = '@ViewBag.MaximumRating'
        if (isSelfDirectAppraisalPage == "True") {
            $('.feedbackenterBox,.btnfeedback').hide();
            $('.admincls,.adminbtn').hide();
            $('.empcls').show();
            $('.managercls').hide();
            $('.btnAdd').show();
            EMPLOYEE_ID = 0;
            APPRAISAL_PROCESS_PERIOD_ID = 0;
            getTabValue();
            getemployeesbasicdetails();
            getFeedbackComments();
            getempRatingsForKraSkills(isSelfDirectAppraisalPage, EMPLOYEE_ID, APPRAISAL_PROCESS_PERIOD_ID);
        } else {
            $('.feedbackenterBox,.btnfeedback').show();
            EMPLOYEE_ID = '@ViewBag.EmpId';
            APPRAISAL_PROCESS_PERIOD_ID = '@ViewBag.AppraisalProcessId';
            $('.empcls').hide();
            $('.managercls').show();
            $('.btnAdd').show();

            ManagerViewEmployeeDetails();

            getempRatingsForKraSkills(isSelfDirectAppraisalPage, EMPLOYEE_ID, APPRAISAL_PROCESS_PERIOD_ID);

        }
        //$('.EmpWeightcls').on('click', function () {

        //    if ($('.popover').hasClass('in')) {
        //        $('#attendanceInfo').popover('hide');
        //    }
        //    else {
        if ($('.EmpWeightcls').is(':disabled')) {
            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
        }
        if ($('.ManagerWeightcls').is(':disabled')) {
            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
        }
        if ($('.ManagerWeightcls').is(':disabled') && $('.EmpWeightcls').is(':disabled')) {
            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
        }
        //  $('#attendanceInfo').attr('data-content', 'Cannot proceed with Save while Editing a row.');
        $('#attendanceInfo').popover('show');

        if (sessionrole == '2' || sessionrole == '4' || isSelfDirectAppraisalPage == "True") {
            $('#feedBackSummary').hide();
        }


        $('.clsFB').on('click', function () {
            if ($('.clsFB').hasClass('smFBFntSize')) {
                $('.clsFB').removeClass('lgFBFntSize').addClass('smFBFntSize');
                $(this).removeClass('smFBFntSize').addClass('lgFBFntSize');
                feedBackCategory = $(this)[0].id; 

            }
            else if ($('.clsFB').hasClass('lgFBFntSize')) {
                $('.clsFB').removeClass('smFBFntSize').addClass('lgFBFntSize');
                $(this).removeClass('lgFBFntSize').addClass('smFBFntSize');
            }

            $('.clsFB').css("color", "");
            var feedBackCategorycolor = this.id == "reward" ? '#FFDF00' : this.id == "positive" ? '#20e820' : this.id == "observation" ? '#37b563' : this.id == "training" ? '#007bff' : this.id == "negative" ? '#ff0000' : '';
            $(this).css("color", feedBackCategorycolor);

        });

        $('.nav-item').on('click', function () {
            if($(this).hasClass('managerCommends'))
            {
                $('#attendanceInfo').popover('hide');
            }
            else
            {
                $('#attendanceInfo').popover('show');
            }
        });





        setTimeout(function () { $('#tabContentDiv').prop('hidden', false); }, 750)

    });

    function getemployeesbasicdetails() {

        $.ajax({
            type: 'get',
            url: '@Url.Content("~/PerformanceAppraisal/GetEmployeeBasicDetails")',
            // data: { empId: emp, managerId: postedby, feedback: feedback },
            success: function (data) {

                empDetails = JSON.parse(data.result1);
                for (var i = 0; i < empDetails.length; i++) {
                    if (empDetails[i].id == '@Session["UserID"].ToString()') {
                        commenter = empDetails[i].Firstname + ' ' + empDetails[i].Lastname;
                    }
                }
            }
        });
    }
    function AddFeedback() {
        var feedback = $('#feedbackinput').val().trim();
        //    var commenter='';
        if (feedback == '') {
            return false;
        }
        var postedby = '';
        var emp = '';
        var created_on = dateValueFormat(new Date());

        $('.feedbacklist').append($('<li><div class="commenterImage"><img height="30" width="30" src="data:image/png;base64,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"></div><div class="commentText"><p class="">' + feedback + '</p><span class="date sub-text">' + commenter + ' - ' + 'on ' + created_on + '</span></div></li>'));
        $(".commentList").animate({ scrollTop: $(document).height() }, 'fast');
        $('#feedbackinput').val('');


        if (isSelfDirectAppraisalPage == 'False') {
            postedby = '@Session["UserID"].ToString()';

            emp = descriptionList[0].Employee_Id;
        }
        else {
            $('.feedbackenterBox').hide();
            //      postedby = '@Session["UserID"].ToString()';
            //    emp='@Session["UserID"].ToString()';
        }

        $.ajax({
            type: 'post',
            url: '@Url.Content("~/PerformanceAppraisal/AddEmployeeFeedbackDetails")',
            data: { empId: emp, managerId: postedby, feedback: feedback, AppraisalProcessId: '@ViewBag.AppraisalProcessId' },
            success: function (data) {

                //   bootbox.alert("Successfully Added");
            }
        });
    }

    function getFeedbackComments() {

        var user;
        if (isSelfDirectAppraisalPage == 'False') {
            user = descriptionList[0].Employee_Id;
        }
        else {
            user = '@Session["UserID"].ToString()';
        }
        $.ajax({
            type: 'get',
            async: false,
            url: '@Url.Content("~/PerformanceAppraisal/getFeedbackComments")',
            data: { EmpId: user, AppraisalProcessId: '@ViewBag.AppraisalProcessId' },
            success: function (data) {
                feedbackComments = JSON.parse(data.result1);
                for (var i = 0; i < feedbackComments.length; i++) {
                    $('.feedbacklist').append($('<li><div class="commenterImage"><img height="30" width="30" src="data:image/png;base64,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"></div><div class="commentText"><p class="">' + feedbackComments[i].FeedBack + '</p><span class="date sub-text">' + feedbackComments[i].ManagerName + ' - ' + 'on ' + dateValueFormat(feedbackComments[i].CreatedOn) + '</span></div></li>'));
                }
            }
        });
    }


    function dateValueFormat(date) {
        var d = new Date(date);
        var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul",
                        "Aug", "Sep", "Oct", "Nov", "Dec"];
        //  var val = d.getDate() + "-" + months[d.getMonth()] + "-" + d.getFullYear();
        var val = months[d.getMonth()] + " " + d.getDate() + " " + d.getFullYear();
        return val;
    }



    function AdminAsManagerViewAppraisal(descriptionList) {
        
        if ('@Session["UserID"].ToString()' == descriptionList[0].Manager_Id && descriptionList[0].Staging <= 1) {
            if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null) {
                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                $('#attendanceInfo').popover('show');
            }
            else {
                $('#attendanceInfo').attr('data-content', '');
                $('#attendanceInfo').popover('hide');
            }


            if ('@Session["UserID"].ToString()' == descriptionList[0].Manager_Id && descriptionList[0].Staging == 1) {
                $('.ManagerWeightcls').attr('disabled', false);
                $('.managerbtn ').show();
                //$('.noFeedback').hide();
                //$('.feedbackSection').show();
                $('.enterCommentcls').show();
            }
            else {
                $('.ManagerWeightcls').attr('disabled', true);
                $('.managerbtn ').hide();
                $('.enterCommentcls').hide();

            }

        }
        else {
            if (descriptionList[0].Staging == 2 ) {
                $('.enterCommentcls').hide();
                $('.adminbtn').hide();
                $('.AdminWeightcls').attr('disabled', true);
                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                $('#attendanceInfo').popover('show');
            }
        }

    }




    function stageChecking() {

        KRA_quest = '';
        Skill_quest = '';
        Summary_quest = '';
        $('#KRA_quest').html('');
        $('#Skill_quest').html('');
        $('#Summary_quest').html('');
        var skillCount = 0;
        var kraCount = 0;

        $.ajax({
            type: "GET",
            url: '@Url.Content("~/PerformanceAppraisal/GetSelfAppraisalTabNameAndData")',
            data: { employeeid: '@ViewBag.EmpId', isSelfDirectAppraisalPage: isSelfDirectAppraisalPage, viewStatus: 2, AppraisalProcessId: '@ViewBag.AppraisalProcessId' },
            success: function (data) {
                if (data.result2 != '[]') {
                    typeList = JSON.parse(data.result1);
                    $('#AppraisalDescription').html(' (' + typeList[0].APPRAISAL_DESCRIPTION + ') ');

                    $('#empName').text(typeList[0].EMP_NAME)
                    $('#empCode').text(typeList[0].EMP_CODE)
                    $('#empDesg').text(typeList[0].EMP_DESIGNATION)
                    descriptionList = JSON.parse(data.result2);

                    for (var i = 0; i < typeList.length; i++) {
                        var count = 0;
                        for (var j = 0; j < descriptionList.length; j++) {

                            if (descriptionList[j].EmployeeWeightage == null) {
                                descriptionList[j].EmployeeWeightage = 0.0;
                            }
                            if (descriptionList[j].ManagerWeightage == null) {
                                descriptionList[j].ManagerWeightage = 0.0;
                            }
                            if (descriptionList[j].FinalEvaluatorWeightage == null) {
                                descriptionList[j].FinalEvaluatorWeightage = 0.0;
                            }
                            if (descriptionList[j].Manager_Summary == null) {
                                descriptionList[j].Manager_Summary = '';
                            }
                            if (descriptionList[j].Self_Summary == null) {
                                descriptionList[j].Self_Summary = '';
                            }
                            if (descriptionList[j].FinalEvaluator_Summary == null) {
                                descriptionList[j].FinalEvaluator_Summary = '';
                            }
                            if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'KRA') {
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                    KRA_quest = KRA_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="AdminCircle" title="' + descriptionList[j].FinalEvaluatorWeightage + '" id="AdminWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 2) {
                                    KRA_quest = KRA_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div><div class="ManagerCircle nomanagercls" title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="range-slider"><input type="range" onchange="changeweightagecls(3,1)"  min="0.0" max="5" value=' + descriptionList[j].FinalEvaluatorWeightage + ' step="0.1" class="slider AdminWeightcls" id="AdminWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].FinalEvaluatorWeightage + '</span></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                    KRA_quest = KRA_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="range-slider"><input type = "range" min = "0.0" max = "5" onchange="changeweightagecls(1,1)" value = ' + descriptionList[j].EmployeeWeightage + ' step = "0.0"   class="slider EmpWeightcls " id = "rangeSelelct_' + descriptionList[j].Id + '" ><span id="rangeSelelctVal_' + descriptionList[j].Id + '" class="range-slider__value">' + descriptionList[j].EmployeeWeightage + '</span></div ></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,1)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div><div class="col-lg-2 noadmincls"><div class="range-slider"><input type="range"  min="0.0" max="5" value=' + descriptionList[j].FinalEvaluatorWeightage + ' step="0.1" class="slider AdminWeightcls" id="AdminWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].FinalEvaluatorWeightage + '</span></div></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 1) {
                                    KRA_quest = KRA_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,1)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div><div class="col-lg-2 noadmincls"><div class="range-slider"><input type="range"  min="0.0" max="5" value=' + descriptionList[j].FinalEvaluatorWeightage + ' step="0.1" class="slider AdminWeightcls" id="AdminWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].FinalEvaluatorWeightage + '</span></div></div></div></div><br/>'
                                }
                                count++;
                            }
                            else if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'Skill') {
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                    Skill_quest = Skill_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="AdminCircle" title="' + descriptionList[j].FinalEvaluatorWeightage + '" id="AdminWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 2) {
                                    Skill_quest = Skill_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div><div class="ManagerCircle nomanagercls" title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="range-slider"><input type="range" onchange="changeweightagecls(3,2)"  min="0.0" max="5" value=' + descriptionList[j].FinalEvaluatorWeightage + ' step="0.1" class="slider AdminWeightcls" id="AdminWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].FinalEvaluatorWeightage + '</span></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                    Skill_quest = Skill_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="range-slider"><input type = "range" min = "0.1" max = "5" onchange="changeweightagecls(1,1)" value = ' + descriptionList[j].EmployeeWeightage + ' step = "0.1"   class="slider EmpWeightcls " id = "rangeSelelct_' + descriptionList[j].Id + '" ><span id="rangeSelelctVal_' + descriptionList[j].Id + '" class="range-slider__value">' + descriptionList[j].EmployeeWeightage + '</span></div ></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,1)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div><div class="col-lg-2 noadmincls"><div class="range-slider"><input type="range"  min="0.0" max="5" value=' + descriptionList[j].FinalEvaluatorWeightage + ' step="0.1" class="slider AdminWeightcls" id="AdminWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].FinalEvaluatorWeightage + '</span></div></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 1) {
                                    Skill_quest = Skill_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,2)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div><div class="col-lg-2 noadmincls"><div class="range-slider"><input type="range"  min="0.0" max="5" value=' + descriptionList[j].FinalEvaluatorWeightage + ' step="0.1" class="slider AdminWeightcls" id="AdminWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].FinalEvaluatorWeightage + '</span></div></div></div></div><br/>'
                                }
                                count++;
                            }
                            else if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'Summary') {
                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="mngcmt' + descriptionList[j].Id + '" class="managercmtlist"></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 2 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 1) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="mngcmt' + descriptionList[j].Id + '" class="managercmtlist"></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 2 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 2) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="ManagerCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Manager</span><p class="  ManagerSummaryCls"   id="MngSummary' + descriptionList[j].Id + '">' + descriptionList[j].Manager_Summary + '</p> <span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 3 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'

                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="ManagerCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Manager</span><p class="  ManagerSummaryCls"   id="MngSummary' + descriptionList[j].Id + '">' + descriptionList[j].Manager_Summary + '</p> <span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="AdminCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Moderator</span><p class="  AdminSummaryCls"   id="AdminSummary' + descriptionList[j].Id + '">' + descriptionList[j].FinalEvaluator_Summary + '</p> <span id="AdminSummaryDate' + descriptionList[j].Id + '"  class="date sub-text AdminSummaryDateCls">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 3 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'

                                }
                                count++;
                            }

                        }
                    }
                    $('#KRA_quest').html(KRA_quest);
                    $('#Skill_quest').html(Skill_quest);
                    $('#Summary_quest').html(Summary_quest);
                    setRangeSliderValues();
                    spinnerControlDisplay();
                    getemployeesbasicdetails();
                    getFeedbackComments();

                    if (descriptionList[0].Staging >= 3 && descriptionList[0].Final_Rating_Completion != null) {
                        $('.update-info').html('Successfully Submitted on ' + '<span>' + dateValueFormat(descriptionList[0].Final_Rating_Completion) + '</span>');
                    }
                    else {
                        $('.update-info').html('');
                    }
                    if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined) {
                        $('.EmpWeightcls,.ManagerWeightcls,.AdminWeightcls').attr('disabled', true);
                        $('.empbtn,.managerbtn,.managercls,.noFeedback').hide();
                        $('.admincls').show();
                        $('.enterCommentcls,#EmpCommentBox').hide();
                        $('#ManagerCommends,.adminbtn,.commentList').hide();

                    }
                    if (descriptionList[0].Staging == 1) {
                        $('.EmpWeightcls,.ManagerWeightcls,.AdminWeightcls').attr('disabled', true);
                        $('.empbtn,.managerbtn,.managercls,.noFeedback').hide();
                        $('.admincls,#EmpCommentBox').show();
                        $('.enterCommentcls,.adminbtn').hide();

                    }
                    if (descriptionList[0].Staging == 2) {
                        $('.EmpWeightcls,.ManagerWeightcls').attr('disabled', true);
                        $('.empbtn,.managerbtn,.managercls,.noFeedback').hide();
                        $('.admincls,#EmpCommentBox,.AdminWeightcls,.adminbtn').show();
                       
                        if ('@Session["UserID"].ToString()' == descriptionList[0].Final_Evaluator_Id) {
                            $('.AdminWeightcls').attr('disabled', false);
                            $('.adminbtn').show();
                            $('.enterCommentcls').show();
                        }
                        else {
                            $('.AdminWeightcls').attr('disabled', true);
                            $('.adminbtn').hide();
                            $('.enterCommentcls').hide();
                        }
                        //for (var j = 0; j < descriptionList.length; j++) {
                        //    if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                        //        $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                        //    }
                        //    if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                        //        $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                        //    }
                        //}
                    }



                    if (descriptionList[0].Staging == 3) {

                        $('.admincls').show();
                        $('.EmpWeightcls,.ManagerWeightcls').attr('disabled', true);
                        $('.empbtn,.managerbtn,.empcls,.managercls,.noFeedback,.adminbtn').hide();
                        $('#EmpCommentBox,.AdminWeightcls').show();
                        $('.enterCommentcls').hide();
                        $('.feedbackenterBox').hide();
                        $('.feedbacklist').show();
                        //for (var j = 0; j < descriptionList.length; j++)
                        //{
                        //    if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                        //        $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                        //    }
                        //    if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                        //        $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                        //    }
                        //    if (descriptionList[j].FinalEvaluator_Summary == null || descriptionList[j].FinalEvaluator_Summary == '') {
                        //        $('#AdminCommentBox' + descriptionList[j].Id + '').hide();
                        //    }
                        //}
                        //if (feedbackComments.length == 0) {
                        //    $('.noFeedback').show();
                        //}
                        //else {
                        //    $('.noFeedback').hide();
                        //}

                    }

                    for (var j = 0; j < descriptionList.length; j++) {
                        if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                            $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                        }
                        if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                            $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                        }
                        if (descriptionList[j].FinalEvaluator_Summary == null || descriptionList[j].FinalEvaluator_Summary == '') {
                            $('#AdminCommentBox' + descriptionList[j].Id + '').hide();
                        }
                    }


                    if ($('.EmpWeightcls').is(':disabled')) {
                        $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                    }
                    if ($('.ManagerWeightcls').is(':disabled')) {
                        $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                    }
                    if ($('.ManagerWeightcls').is(':disabled') && $('.EmpWeightcls').is(':disabled')) {
                        $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                    }
                    if ($('.AdminWeightcls').is(':disabled')) {

                        if ('@Session["UserID"].ToString()' == descriptionList[0].Final_Evaluator_Id) {
                            if ($('.ManagerWeightcls').is(':disabled')) {
                                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                            }
                            if ($('.ManagerWeightcls').is(':disabled') && $('.EmpWeightcls').is(':disabled')) {
                                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                            }
                        }
                        else {
                            $('#attendanceInfo').attr('data-content', 'Not Allowed');

                        }
                    }
                    if ((descriptionList[0].Final_Evaluator_Id == '@Session["UserID"].ToString()' || descriptionList[0].Manager_Id == '@Session["UserID"].ToString()') && '@ViewBag.ViewType' == '1') {
                        
                        AdminAsManagerViewAppraisal(descriptionList);
                    }
                    if (descriptionList[0].Manager_Id == 0) {
                        $('.nomanagercls').hide();
                        if ($('.EmpWeightcls').is(':disabled')) {
                            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                        }
                        if (descriptionList[0].Staging == 2 && '@Session["UserID"].ToString()' != descriptionList[0].Final_Evaluator_Id) {
                            $('#attendanceInfo').attr('data-content', 'Employee does not have manager rating,so moderator yet to give his rating...!');
                        }
                        if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null) {
                            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                        }

                        if (descriptionList[0].Staging == 2 && '@Session["UserID"].ToString()' == descriptionList[0].Final_Evaluator_Id && '@ViewBag.ViewType' == '1') {
                            $('.enterCommentcls').hide();
                            $('.adminbtn').hide();
                            $('.AdminWeightcls').attr('disabled', true);
                            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                            $('#attendanceInfo').popover('show');
                        }
                    }
                    $('#attendanceInfo').popover('show');

                    if (descriptionList[0].Manager_Id == 0) {
                        $('.nomanagercls').hide();
                    }

                    if (descriptionList[0].FEEDBACK_CATEGORY != '' || descriptionList[0].FEEDBACK_CATEGORY != null) {
                        $('#' + descriptionList[0].FEEDBACK_CATEGORY).addClass('lgFBFntSize')
                        //$('.clsFB').trigger('click');
                        feedBackCategory = descriptionList[0].FEEDBACK_CATEGORY;
                        var feedBackCategorycolor = feedBackCategory == "reward" ? '#FFDF00' : feedBackCategory == "positive" ? '#20e820' : feedBackCategory == "observation" ? '#37b563' : feedBackCategory == "training" ? '#007bff' : feedBackCategory == "negative" ? '#ff0000' : '';
                        $('#' + feedBackCategory).css("color", feedBackCategorycolor);
                    }

                }

                else {
                    $('.nodatacls').show();
                    $('.managercls,.empcls,.admincls,.adminbtn,.feedbackenterBox').hide();
                    typeList = [];
                    descriptionList = [];
                    $('#empDetailsDiv').hide();
                    $('#feedBackSummary,#ManagerCommends').hide();

                }



            }, error: function (err) {
                alert("error");
            }
        });
        $('.btnAdd').show();
    }
    function spinnerControlDisplay() {
        $('.WeightageCircle').each(function (i, obj) {


            Circles.create({
                id: obj.id,
                value: obj.title,
                text: function (value) { return value + '%'; },
                radius: 23,
                width: 6,
                duration: 3,
                //  colors: ['#dedddd', '#2c3e50']
                colors: ['#dedddd', '#3d79b5']
            });
        });
        $('.EmpCircle,.ManagerCircle,.AdminCircle').each(function (i, obj) {


            Circles.create({
                id: obj.id,
                value: obj.title,
                radius: 23,
                maxValue: 10,                 // assume 10 is max
                width: 6,
                duration: 3,
                colors: ['#dedddd', '#3d79b5']
            });
        });
    }
    function closeTab() {
        if ('@ViewBag.ViewType' == '0') {
            window.location.href = '@Url.Content("~/Messages/ShowMessages")';
        }
        if ('@ViewBag.ViewType' == '1') {
            window.location.href = '@Url.Content("~/PerformanceAppraisal/TeamMembersAppraisal")';
        }
        if ('@ViewBag.ViewType' == '2') {
            window.location.href = '@Url.Content("~/PerformanceAppraisal/ModeratorReviewPage")';
        }
        if ('@ViewBag.ViewType' == '3') {
            window.location.href = '@Url.Content("~/PerformanceAppraisal/RedirectFromAppraisalPage?ViewType=")' + '@ViewBag.ViewType' + '&AppraisalProcessId=' + '@ViewBag.AppraisalProcessId' + '&AppraisalActiveStage=' + '@ViewBag.AppraisalActiveStage';
        }
    }



    function ManagerViewEmployeeDetails() {
        KRA_quest = '';
        Skill_quest = '';
        Summary_quest = '';
        $('#KRA_quest').html('');
        $('#Skill_quest').html('');
        $('#Summary_quest').html('');
        var skillCount = 0;
        var kraCount = 0;
        if (sessionrole == '1') {
            stageChecking();
        }
        else {
            $.ajax({
                type: "GET",
                url: '@Url.Content("~/PerformanceAppraisal/GetSelfAppraisalTabNameAndData")',
                data: { employeeid: '@ViewBag.EmpId', isSelfDirectAppraisalPage: isSelfDirectAppraisalPage, viewStatus: 1, AppraisalProcessId: '@ViewBag.AppraisalProcessId' },
                success: function (data) {
                    if (data.result2 != '[]') {
                        typeList = JSON.parse(data.result1);
                        //      appraisal_description = typeList[0].APPRAISAL_DESCRIPTION;
                        $('#AppraisalDescription').html(' (' + typeList[0].APPRAISAL_DESCRIPTION + ') ');
                        $('#empName').text(typeList[0].EMP_NAME)
                        $('#empCode').text(typeList[0].EMP_CODE)
                        $('#empDesg').text(typeList[0].EMP_DESIGNATION)
                        descriptionList = JSON.parse(data.result2);
                        //if (sessionrole == '1') {
                        //    stageChecking();
                        //}
                        //     else {
                        for (var i = 0; i < typeList.length; i++) {
                            var count = 0;
                            for (var j = 0; j < descriptionList.length; j++) {

                                if (descriptionList[j].EmployeeWeightage == null) {
                                    descriptionList[j].EmployeeWeightage = 0.1;
                                }
                                if (descriptionList[j].ManagerWeightage == null) {
                                    descriptionList[j].ManagerWeightage = 0.1;
                                }
                                if (descriptionList[j].Manager_Summary == null) {
                                    descriptionList[j].Manager_Summary = '';
                                }
                                if (descriptionList[j].Self_Summary == null) {
                                    descriptionList[j].Self_Summary = '';
                                }
                                if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'KRA') {
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 2) {
                                        KRA_quest = KRA_quest + '<div class="managercls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-5"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 1) {
                                        KRA_quest = KRA_quest + '<div class="managercls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-5"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,1)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div></div></div><br/>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                        KRA_quest = KRA_quest + '<div class="managercls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-5"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="range-slider"><input type = "range" min = "0.1" max = "5" onchange="changeweightagecls(1,1)" value = ' + descriptionList[j].EmployeeWeightage + ' step = "0.1"   class="slider EmpWeightcls " id = "rangeSelelct_' + descriptionList[j].Id + '" ><span id="rangeSelelctVal_' + descriptionList[j].Id + '" class="range-slider__value">' + descriptionList[j].EmployeeWeightage + '</span></div ></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,1)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div></div></div><br/>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                        KRA_quest = KRA_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="AdminCircle" title="' + descriptionList[j].FinalEvaluatorWeightage + '" id="AdminWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                    }
                                    count++;
                                }
                                else if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'Skill') {
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 2) {
                                        Skill_quest = Skill_quest + '<div class="managercls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-5"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 1) {
                                        Skill_quest = Skill_quest + '<div class="managercls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-5"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,2)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div></div></div><br/>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                        Skill_quest = Skill_quest + '<div class="managercls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-5"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="range-slider"><input type = "range" min = "0.1" max = "5" onchange="changeweightagecls(1,1)" value = ' + descriptionList[j].EmployeeWeightage + ' step = "0.1"   class="slider EmpWeightcls " id = "rangeSelelct_' + descriptionList[j].Id + '" ><span id="rangeSelelctVal_' + descriptionList[j].Id + '" class="range-slider__value">' + descriptionList[j].EmployeeWeightage + '</span></div ></div><div class="col-lg-2 nomanagercls"><div class="range-slider"><input type="range"  min="0.0" max="5" onchange="changeweightagecls(2,2)" value=' + descriptionList[j].ManagerWeightage + ' step="0.1" class="slider ManagerWeightcls" id="MngWeightage' + descriptionList[j].Id + '"><span id="rangeSliderVal" class="range-slider__value">' + descriptionList[j].ManagerWeightage + '</span></div></div></div></div><br/>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                        Skill_quest = Skill_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="AdminCircle" title="' + descriptionList[j].FinalEvaluatorWeightage + '" id="AdminWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                    }
                                    count++;
                                }
                                else if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'Summary') {

                                    if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined || descriptionList[j].Staging <= 1) {
                                        Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="mngcmt' + descriptionList[j].Id + '" class="managercmtlist"></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 2 + ')" class="btn  btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'
                                    }
                                    if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 2) {
                                        Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="ManagerCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Manager</span><p class="  ManagerSummaryCls"   id="MngSummary' + descriptionList[j].Id + '">' + descriptionList[j].Manager_Summary + '</p> <span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 3 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'

                                    }
                                    if (descriptionList[j].Staging == 3) {
                                        Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="ManagerCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Manager</span><p class="  ManagerSummaryCls"   id="MngSummary' + descriptionList[j].Id + '">' + descriptionList[j].Manager_Summary + '</p> <span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="AdminCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Moderator</span><p class="  AdminSummaryCls"   id="AdminSummary' + descriptionList[j].Id + '">' + descriptionList[j].FinalEvaluator_Summary + '</p> <span id="AdminSummaryDate' + descriptionList[j].Id + '"  class="date sub-text AdminSummaryDateCls">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 3 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></button></div></div></div></div>'

                                    }
                                    count++;
                                }

                            }
                        }
                        $('#KRA_quest').html(KRA_quest);
                        $('#Skill_quest').html(Skill_quest);
                        $('#Summary_quest').html(Summary_quest);
                        setRangeSliderValues();
                        spinnerControlDisplay();
                        getemployeesbasicdetails();
                        getFeedbackComments();
                        if (descriptionList[0].Staging >= 2 && descriptionList[0].Evaluator_Rating_Completion != null) {
                            $('.update-info').html('Successfully Submitted on ' + '<span >' + dateValueFormat(descriptionList[0].Evaluator_Rating_Completion) + '</span>');

                        }
                        else {
                            $('.update-info').html('');
                        }
                        if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined) {
                            $('.empcls').hide();
                            $('.managercls').show();
                            $('.EmpWeightcls,.ManagerWeightcls').attr('disabled', true);
                            $('.empbtn,.managerbtn').hide();
                            $('.admincls,.adminbtn').hide();
                            $('.enterCommentcls,#EmpCommentBox').hide();
                            //$('.noFeedback').show();
                            //$('.feedbackSection').hide();
                            $('#ManagerCommends,.commentList').hide();


                        }
                        if (descriptionList[0].Staging == 1) {
                            $('.noFeedback').hide();
                            $('.admincls,.adminbtn ').hide();
                            $('.EmpWeightcls').attr('disabled', true);
                            //if (sessionrole == '1') {
                            //    $('.empbtn,.managerbtn').hide();
                            //    $('.admincls,.adminbtn').hide();
                            //}
                            if ('@Session["UserID"].ToString()' == descriptionList[0].Manager_Id) {
                                $('.ManagerWeightcls').attr('disabled', false);
                                $('.managerbtn ').show();
                                //$('.noFeedback').hide();
                                //$('.feedbackSection').show();
                                $('.enterCommentcls').show();
                            }
                            else {
                                $('.ManagerWeightcls').attr('disabled', true);
                                $('.managerbtn ').hide();
                                $('.enterCommentcls').hide();

                            }
                            // $('#ManagerCommends').show();

                        }
                        if (descriptionList[0].Staging == 2) {
                            $('.noFeedback,.admincls').hide();
                            //       $('.EmpWeightcls,.EmpSummaryCls,.ManagerWeightcls,.ManagerSummaryCls').attr('disabled', true);
                            $('.EmpWeightcls,.ManagerWeightcls').attr('disabled', true);
                            if (sessionrole == '3') {

                                $('.empbtn,.managerbtn,.adminbtn').hide();


                            }
                            if ('@Session["UserID"].ToString()' == descriptionList[0].Final_Evaluator_Id) {
                                $('.AdminWeightcls').attr('disabled', false);
                                $('.adminbtn').show();
                            }
                            else {
                                $('.AdminWeightcls').attr('disabled', true);
                                $('.adminbtn').hide();
                            }
                            //    $('.feedbackenterBox').hide();
                            $('.feedbacklist').show();

                            //if (feedbackComments.length == 0) {
                            //    $('.noFeedback').show();
                            //}
                            //else {
                            //    $('.noFeedback').hide();
                            //}


                        }


                        if (descriptionList[0].Staging == 2) {
                            $('.enterCommentcls').hide();
                            $('.empbtn,.managerbtn,.adminbtn').hide();
                            //   $('button').hide();
                            if (isSelfDirectAppraisalPage == 'False') {
                                $('.btnclose').show();
                            }
                            //    $('.feedbackenterBox').hide();
                            $('.feedbacklist').show();
                            //for (var j = 0; j < descriptionList.length; j++) {
                            //    if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                            //        $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                            //    }
                            //    if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                            //        $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                            //    }

                            //}
                            //if (feedbackComments.length == 0) {
                            //    $('.noFeedback').show();
                            //}
                            //else {
                            //    $('.noFeedback').hide();
                            //}
                        }
                        //if (descriptionList[0].Staging == 3) {
                        //    $('.admincls,.adminbtn').show();
                        //}

                        if (descriptionList[0].Staging == 3) {
                            $('.admincls').show();
                            $('.EmpWeightcls,.ManagerWeightcls').attr('disabled', true);
                            $('.empbtn,.managerbtn,.managercls,.empcls,.noFeedback,.adminbtn').hide();
                            $('#EmpCommentBox,.AdminWeightcls').show();
                            $('.enterCommentcls').hide();
                            $('.feedbackenterBox').hide();
                            $('.feedbacklist').show();
                            //for (var j = 0; j < descriptionList.length; j++) {
                            //    if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                            //        $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                            //    }
                            //    if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                            //        $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                            //    }
                            //    if (descriptionList[j].FinalEvaluator_Summary == null || descriptionList[j].FinalEvaluator_Summary == '') {
                            //        $('#AdminCommentBox' + descriptionList[j].Id + '').hide();
                            //    }
                            //}
                            //if (feedbackComments.length == 0) {
                            //    $('.noFeedback').show();
                            //}
                            //else {
                            //    $('.noFeedback').hide();
                            //}

                        }

                        //if (feedbackComments.length == 0) {

                        //    $('.noFeedback').show();
                        //}
                        //else {
                        //    $('.noFeedback').hide();
                        //}
                        for (var j = 0; j < descriptionList.length; j++) {
                            if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                                $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                            }
                            if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                                $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                            }
                            if (descriptionList[j].FinalEvaluator_Summary == null || descriptionList[j].FinalEvaluator_Summary == '') {
                                $('#AdminCommentBox' + descriptionList[j].Id + '').hide();
                            }
                        }


                        if ($('.EmpWeightcls').is(':disabled')) {
                            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                        }
                        if ($('.ManagerWeightcls').is(':disabled')) {
                            if ('@Session["UserID"].ToString()' == descriptionList[0].Manager_Id) {
                                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                            }
                            else {
                                $('#attendanceInfo').attr('data-content', 'Not Allowed');
                            }
                        }
                        if ($('.ManagerWeightcls').is(':disabled') && $('.EmpWeightcls').is(':disabled')) {
                            $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                        }


                        if (descriptionList[0].Manager_Id == 0) {
                            $('.nomanagercls').hide();
                            if ($('.EmpWeightcls').is(':disabled')) {
                                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                            }
                            if (descriptionList[0].Staging == 2) {
                                $('#attendanceInfo').attr('data-content', 'Employee does not have manager rating,so moderator yet to give his rating...!');
                            }
                            if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null) {
                                $('#attendanceInfo').attr('data-content', 'Oops! Something went wrong. Appraisal status is Pending review / rating');
                            }
                        }
                        $('#attendanceInfo').popover('show');




                        if (descriptionList[0].FEEDBACK_CATEGORY != '' || descriptionList[0].FEEDBACK_CATEGORY != null) {
                            $('#' + descriptionList[0].FEEDBACK_CATEGORY).addClass('lgFBFntSize')
                            //$('.clsFB').trigger('click');
                            feedBackCategory = descriptionList[0].FEEDBACK_CATEGORY;
                            var feedBackCategorycolor = feedBackCategory == "reward" ? '#FFDF00' : feedBackCategory == "positive" ? '#20e820' : feedBackCategory == "observation" ? '#37b563' : feedBackCategory == "training" ? '#007bff' : feedBackCategory == "negative" ? '#ff0000' : '';
                            $('#' + feedBackCategory).css("color", feedBackCategorycolor);
                        }



                    }


                    else {
                        $('.nodatacls').show();
                        $('.managercls,.empcls,.admincls,.adminbtn,.feedbackenterBox').hide();
                        typeList = [];
                        descriptionList = [];
                        $('#empDetailsDiv').hide();
                        $('#feedBackSummary,#ManagerCommends').hide();

                    }



                }, error: function (err) {
                    alert("error");
                }
            });
        }
        $('.btnAdd').show();
    }
    function toggleCommentBoxSummary(idno) {
        $('.actionBox' + idno).slideToggle();
    }
    function getTabValue() {

        KRA_quest = '';
        Skill_quest = '';
        Summary_quest = '';
        $('#KRA_quest').html('');
        $('#Skill_quest').html('');
        $('#Summary_quest').html('');
        var skillCount = 0;
        var kraCount = 0;
        //if (status == 2)
        //{
        //    divHeader = '<div class="empcls"><div class="row col-lg-12 "><div class="col-lg-1"><b>SL.NO</b></div><div class="col-lg-5"><b>Questions</b></div><div class="col-lg-2"><b>Weightage</b></div><div class="col-lg-2 "><b>Employee Weightage</b></div></div><div disabled class="col-lg-2 "><b>Manager Weightage</b></div></div><br /></div>';
        //}
        $.ajax({
            type: "GET",
            url: '@Url.Content("~/PerformanceAppraisal/GetSelfAppraisalTabNameAndData")',
            data: { employeeid: 0, isSelfDirectAppraisalPage: isSelfDirectAppraisalPage, viewStatus: 0, AppraisalProcessId: 0 },
            success: function (data) {
                if (data.result2 != '[]') {
                    typeList = JSON.parse(data.result1);
                    //      appraisal_description = typeList[0].APPRAISAL_DESCRIPTION;
                    $('#AppraisalDescription').html(' (' + typeList[0].APPRAISAL_DESCRIPTION + ') '); descriptionList = JSON.parse(data.result2);
                    var storeCount = 0;
                    for (var i = 0; i < typeList.length; i++) {
                        var count = 0;
                        for (var j = 0; j < descriptionList.length; j++) {

                            //if (descriptionList[j].EmployeeWeightage == null) {
                            //    descriptionList[j].EmployeeWeightage = 0;
                            //}
                            //if (descriptionList[j].ManagerWeightage == null) {
                            //    descriptionList[j].ManagerWeightage = 0;
                            //}
                            //if (descriptionList[j].FinalEvaluatorWeightage == null) {
                            //    descriptionList[j].FinalEvaluatorWeightage = 0;
                            //}
                            //if (descriptionList[j].Manager_Summary == null) {
                            //    descriptionList[j].Manager_Summary = '';
                            //}
                            //if (descriptionList[j].Self_Summary == null) {
                            //    descriptionList[j].Self_Summary = '';
                            //}
                            if (descriptionList[j].EmployeeWeightage == null) {
                                descriptionList[j].EmployeeWeightage = 0.0;
                            }
                            if (descriptionList[j].ManagerWeightage == null && descriptionList[j].Staging == 3) {
                                descriptionList[j].ManagerWeightage = 0.0;
                            }
                            if (descriptionList[j].FinalEvaluatorWeightage == null && descriptionList[j].Staging == 3) {
                                descriptionList[j].FinalEvaluatorWeightage = 0;
                            }
                            if (descriptionList[j].Manager_Summary == null && descriptionList[j].Staging == 3) {
                                descriptionList[j].Manager_Summary = '';
                            }
                            if (descriptionList[j].Self_Summary == null) {
                                descriptionList[j].Self_Summary = '';
                            }
                            if (descriptionList[j].FinalEvaluator_Summary == null && descriptionList[j].Staging == 3) {
                                descriptionList[j].FinalEvaluator_Summary = '';
                            }
                            if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'KRA') {


                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                    KRA_quest = KRA_quest + '<div class="empcls"><div class="row col-lg-12"><div class="col-lg-2"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-4"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-3"><div class="WeightageCircle weightagecls" value="' + descriptionList[j].Weightage + '" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-3"><div class="range-slider"><input type = "range" min = "0.1" max = "5" onchange="changeweightagecls(1,1)" value = ' + descriptionList[j].EmployeeWeightage + ' step = "0.1"   class="slider EmpWeightcls " id = "rangeSelelct_' + descriptionList[j].Id + '" ><span id="rangeSelelctVal_' + descriptionList[j].Id + '" class="range-slider__value">' + descriptionList[j].EmployeeWeightage + '</span></div ></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[j].Staging >= 1 && descriptionList[j].Staging <= 2)) {
                                    KRA_quest = KRA_quest + '<div class="empcls"><div class="row col-lg-12"><div class="col-lg-2"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-4"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-3"><div class=" WeightageCircle weightagecls" value="' + descriptionList[j].Weightage + '" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-3"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                    KRA_quest = KRA_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="AdminCircle" title="' + descriptionList[j].FinalEvaluatorWeightage + '" id="AdminWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                }
                                count++;

                            }
                            if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'Skill') {
                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined)) {
                                    Skill_quest = Skill_quest + '<div class="empcls"><div class="row col-lg-12"><div class="col-lg-2"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-4"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-3"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-3"><div class="range-slider"><input type = "range" min = "0.1" max = "5" onchange="changeweightagecls(1,2)" value = ' + descriptionList[j].EmployeeWeightage + ' step = "0.1" class="slider EmpWeightcls " id = "rangeSelelct_' + descriptionList[j].Id + '" ><span id="rangeSelelctVal_' + descriptionList[j].Id + '" class="range-slider__value">' + descriptionList[j].EmployeeWeightage + '</span></div ></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && (descriptionList[j].Staging >= 1 && descriptionList[j].Staging <= 2)) {
                                    Skill_quest = Skill_quest + '<div class="empcls"><div class="row col-lg-12"><div class="col-lg-2"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-4"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-3"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-3"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                }
                                if (descriptionList[j].EmployeeWeightage != null && descriptionList[j].Staging == 3) {
                                    Skill_quest = Skill_quest + '<div class="admincls"><div class="row col-lg-12"><div class="col-lg-1"><label  value="' + (j + 1) + '">' + (count + 1) + '</label></div><div class="col-lg-3"><label id="Quest' + descriptionList[j].Id + '"  value"">' + descriptionList[j].Description + '</label></div><div class="col-lg-2"><div class="WeightageCircle weightagecls" title="' + descriptionList[j].Weightage + '" id="Weightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2"><div class="EmpCircle" title="' + descriptionList[j].EmployeeWeightage + '" id="EmpWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 nomanagercls"><div class="ManagerCircle " title="' + descriptionList[j].ManagerWeightage + '" id="MngWeightage' + descriptionList[j].Id + '" ></div></div><div class="col-lg-2 noadmincls"><div class="AdminCircle" title="' + descriptionList[j].FinalEvaluatorWeightage + '" id="AdminWeightage' + descriptionList[j].Id + '" ></div></div></div></div><br/>'
                                }
                                count++;

                            }
                            if (typeList[i].PerformanceTypeID == descriptionList[j].PerformanceTypeID && typeList[i].PerformanceType == 'Summary') {

                                if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="empcmt' + descriptionList[j].Id + '" class="empcmtlist"></li><li id="mngcmt' + descriptionList[j].Id + '" class="managercmtlist"></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 1 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></div></div></div></div>'

                                }
                                if (descriptionList[j].Staging >= 1 && descriptionList[j].Staging <= 2) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="mngcmt' + descriptionList[j].Id + '" class="managercmtlist"></li><li id="fnevlcmt' + descriptionList[j].Id + '" class="finalcmtlist"></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 2 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></div></div></div></div>'

                                }
                                if (descriptionList[j].Staging == 3) {
                                    Summary_quest = Summary_quest + '<div class="detailBox"><div class="titleBox"><div class="commentBox"><p id="Quest' + descriptionList[j].Id + '" class="taskDescription"><span class="q_title"><label  value="' + (j + 1) + '">' + (count + 1) + "." + '</label></span>' + descriptionList[j].Description + '</p><button type="button" class="close commentClose" onclick="toggleCommentBoxSummary(' + descriptionList[j].Id + ')" style="display:block;" aria-hidden="true">&#43;</button></div></div><div class="actionBox actionBox' + descriptionList[j].Id + '"><ul class="commentList commentList' + descriptionList[j].Id + '"><li id="EmpCommentBox' + descriptionList[j].Id + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + descriptionList[j].Id + '" class="EmpSummaryCls" >' + descriptionList[j].Self_Summary + '</p><span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="ManagerCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Manager</span><p class="  ManagerSummaryCls"   id="MngSummary' + descriptionList[j].Id + '">' + descriptionList[j].Manager_Summary + '</p> <span class="date sub-text">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li><li id="AdminCommentBox' + descriptionList[j].Id + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Moderator</span><p class="  AdminSummaryCls"   id="AdminSummary' + descriptionList[j].Id + '">' + descriptionList[j].FinalEvaluator_Summary + '</p> <span id="AdminSummaryDate' + descriptionList[j].Id + '"  class="date sub-text AdminSummaryDateCls">on ' + dateValueFormat(descriptionList[j].Created_Date) + '</span></div></li></ul><div class="form-inline enterCommentcls" ><div class="form-group comment-input"><textarea id="inputAddSummary' + descriptionList[j].Id + '" rows="4" cols="50" name="comment" class="form-control add_comment" placeholder="Your comments..."></textarea></div><div class="form-group"><button id="btnAddSummary' + descriptionList[j].Id + '" onclick="addSummaryComment(' + descriptionList[j].Id + ',' + 3 + ')" class="btn btn-primary btn_add">Add&nbsp;<i class="fa fa-refresh"></i></button></div></div></div></div>'

                                }
                                count++;
                            }

                        }
                        // storeCount = count;
                    }
                    $('#KRA_quest').html(KRA_quest);
                    $('#Skill_quest').html(Skill_quest);
                    $('#Summary_quest').html(Summary_quest);
                    //      stageChecking();

                    if (descriptionList[0].Staging == 0 || descriptionList[0].Staging == null || descriptionList[0].Staging == undefined) {
                        $('.empbtn,.enterCommentcls,.feedbackSection').show();
                        $('.feedbackSection').hide();
                        $('.noFeedback').show();
                        $('#ManagerCommends').hide();
                    }
                    if (descriptionList[0].Staging >= 1 && descriptionList[0].Staging <= 2) {
                        $('.empbtn,.enterCommentcls,.feedbackSection').hide();
                        $('.noFeedback').show();
                        $('#ManagerCommends').hide();
                    }

                    if (descriptionList[0].Staging == 3) {

                        $('.admincls').show();
                        $('.EmpWeightcls,.ManagerWeightcls').attr('disabled', true);
                        $('.empbtn,.managerbtn,.managercls,.empcls,.noFeedback,.adminbtn').hide();
                        $('#EmpCommentBox,.AdminWeightcls').show();
                        $('.enterCommentcls').hide();
                        for (var j = 0; j < descriptionList.length; j++) {
                            if (descriptionList[j].Self_Summary == null || descriptionList[j].Self_Summary == '') {
                                $('#EmpCommentBox' + descriptionList[j].Id + '').hide();
                            }
                            if (descriptionList[j].Manager_Summary == null || descriptionList[j].Manager_Summary == '') {
                                $('#ManagerCommentBox' + descriptionList[j].Id + '').hide();
                            }
                            if (descriptionList[j].FinalEvaluator_Summary == null || descriptionList[j].FinalEvaluator_Summary == '') {
                                $('#AdminCommentBox' + descriptionList[j].Id + '').hide();
                            }
                        }
                        $('#ManagerCommends').show();
                        if (feedbackComments.length == 0) {
                            $('.noFeedback').show();
                        }
                        else {
                            $('.noFeedback').hide();
                            $('.feedbacklist').show();
                        }
                    }


                    //if (descriptionList[0].Staging == 3) {
                    //    $('.empbtn,.enterCommentcls').hide();
                    //    $('.feedbackSection').show();
                    //    $('.noFeedback').hide();
                    //}
                    setRangeSliderValues();
                    spinnerControlDisplay();

                    if (descriptionList[0].Staging >= 1 && descriptionList[0].Self_Rating_Completion != null) {
                        $('.update-info').html('Successfully Submitted on ' + '<span >' + dateValueFormat(descriptionList[0].Self_Rating_Completion) + '</span>');
                    }
                    else {
                        $('.update-info').html('');
                    }
                    if (descriptionList[0].Manager_Id == 0) {
                        $('.nomanagercls').hide();
                    }
                    //    $('#empName').text(typeList[0].EMP_NAME)
                    $('#empDetailsDiv').hide();



                }


                else {

                    $('.nodatacls').show();
                    $('.managercls,.empcls').hide();
                    typeList = [];
                    descriptionList = [];
                    $('#empDetailsDiv').hide();
                    $('#ManagerCommends').hide();
                    $('#feedBackSummary').hide();

                }


            }, error: function (err) {
                alert("error");
            }
        });

    }
    function addSummaryComment(idno, datatype) {


        if (datatype == 1) {
            var data = $('#inputAddSummary' + idno).val().trim();
            if (data == '') {
                $('#empcmt' + idno).html('');
                return false;
            }
            else {
                $('#empcmt' + idno).html('<li class="empCommentBox" id="EmpCommentBox' + idno + '"><div class="commenterImage"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText"><span class="sub-text commentName">Employee</span><p id="EmpSummary' + idno + '" class="EmpSummaryCls" >' + data + '</p><span  id="EmpSummaryDate' + idno + '"  class="date sub-text EmpSummaryDateCls">' + 'on ' + dateValueFormat(new Date()) + '</span></div></li>');
                $(".commentList" + idno).animate({ scrollTop: $(document).height() }, 'fast');
            }

        }

        if (datatype == 2) {
            var data = $('#inputAddSummary' + idno).val().trim();
            if (data == '') {
                $('#mngcmt' + idno).html('');
                return false;
            }

            else {
                $('#mngcmt' + idno).html('<li class="managerCommentBox" id="ManagerCommentBox' + idno + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Manager</span><p class="  ManagerSummaryCls"   id="MngSummary' + idno + '">' + data + '</p> <span id="ManagerSummaryDate' + idno + '"  class="date sub-text ManagerSummaryDateCls">' + 'on ' + dateValueFormat(new Date()) + '</span></div></li>');
                $(".commentList" + idno).animate({ scrollTop: $(document).height() }, 'fast');
            }

        }
        if (datatype == 3) {
            var data = $('#inputAddSummary' + idno).val().trim();
            if (data == '') {
                $('#fnevlcmt' + idno).html('');
                return false;
            }
                //  $("#assetdiv").position().top
            else {
                $('#fnevlcmt' + idno).html('<li class="adminCommentBox" id="AdminCommentBox' + idno + '" style="overflow:hidden;"><div class="commenterImage pull-right" style="float:right;"><img src="@Url.Content("~/images/profile_default.jpg")" /></div><div class="commentText reply_txt pull-right"><span class="sub-text commentName">Moderator</span><p class="  AdminSummaryCls"   id="AdminSummary' + idno + '">' + data + '</p> <span id="AdminSummaryDate' + idno + '"  class="date sub-text AdminSummaryDateCls">' + 'on ' + dateValueFormat(new Date()) + '</span></div></li>');
                $(".commentList" + idno).animate({ scrollTop: $(document).height() }, 'fast');
            }

        }
    }
    function getempRatingsForKraSkills(selfDirect, empid, AppraisalProcessId) {
        $.ajax({
            type: 'GET',
            url: '@Url.Content("~/PerformanceAppraisal/getempRatingsForKraSkills")',
            data: { EmpId: empid, AppraisalProcessId: AppraisalProcessId, isSelfDirectAppraisalPage: isSelfDirectAppraisalPage, viewType: '@ViewBag.ViewType' },
            success: function (data) {
                if (data.result != "NoMappingIsAvailable") {
                    empRatings = JSON.parse(data.result1);
                    if (empRatings.length >= 1) {

                        if (selfDirect == "True") {
                            if (empRatings[0].Self_KRA_Rating != null && empRatings[0].Staging1 >= 1)
                                $('#KRARatingoutoffive').html('<label style="color: blue;"> KRA Rating: ' + empRatings[0].Self_KRA_Rating + '/5.00</label>');
                            if (empRatings[0].Self_Skill_Rating != null && empRatings[0].Staging1 >= 1)
                                $('#SkillsRatingoutoffive').html('<label style="color: blue;"> Skills Rating: ' + empRatings[0].Self_Skill_Rating + '%</label>');

                            if (empRatings[0].Evaluator_KRA_Rating != null && empRatings[0].Staging1 == 3 && descriptionList[0].Manager_Id != 0)
                                $('#Evaluator_KRARatingoutoffive').html('<label style="color: blue;"> Manager Rating: ' + empRatings[0].Evaluator_KRA_Rating + '/5.00</label>');
                            if (empRatings[0].Evaluator_Skill_Rating != null && empRatings[0].Staging1 == 3 && descriptionList[0].Manager_Id != 0)
                                $('#Evaluator_SkillsRatingoutoffive').html('<label style="color: blue;"> Manager Rating: ' + empRatings[0].Evaluator_Skill_Rating + '%</label>');
                            if (empRatings[0].Final_Evaluator_Skill_Rating != null && empRatings[0].Staging1 == 3)
                                $('#Final_Evaluator_KRARatingoutoffive').html('<label style="color: blue;"> Final Rating: ' + empRatings[0].Final_Evaluator_KRA_Rating + '/5.00</label>');
                            if (empRatings[0].Final_Evaluator_Skill_Rating != null && empRatings[0].Staging1 == 3)
                                $('#Final_Evaluator_SkillsRatingoutoffive').html('<label style="color: blue;"> Final Rating: ' + empRatings[0].Final_Evaluator_Skill_Rating + '%</label>');

                            if (empRatings[0].Overall_Rating1 != null && empRatings[0].Staging1 == 3)
                                $('#OverAllRating').html('<label style="color: blue;"> Overall Rating: ' + empRatings[0].Overall_Rating1 + '</label>');
                            //if (empRatings[0].Performance != null && descriptionList[0].Staging == 3)
                            //    $('#performanceDiv').html('<label style="color: blue;"> Performance: ' + empRatings[0].Performance + '</label>');
                            //if (empRatings[0].Potential != null && descriptionList[0].Staging == 3)
                            //    $('#potentialDiv').html('<label style="color: blue;"> Potential: ' + empRatings[0].Potential + '</label>');
                        } else {
                            if (empRatings[0].Self_KRA_Rating != null && empRatings[0].Staging1 >= 1)
                                $('#KRARatingoutoffive').html('<label style="color: blue;"> Self Rating: ' + empRatings[0].Self_KRA_Rating + '/5.00</label>');
                            if (empRatings[0].Self_Skill_Rating != null && empRatings[0].Staging1 >= 1)
                                $('#SkillsRatingoutoffive').html('<label style="color: blue;"> Self Rating: ' + empRatings[0].Self_Skill_Rating + '%</label>');
                            if (empRatings[0].Evaluator_KRA_Rating != null && empRatings[0].Staging1 >= 2 && descriptionList[0].Manager_Id != 0)
                                $('#Evaluator_KRARatingoutoffive').html('<label style="color: blue;"> Manager Rating: ' + empRatings[0].Evaluator_KRA_Rating + '/5.00</label>');
                            if (empRatings[0].Evaluator_Skill_Rating != null && empRatings[0].Staging1 >= 2 && descriptionList[0].Manager_Id != 0)
                                $('#Evaluator_SkillsRatingoutoffive').html('<label style="color: blue;"> Manager Rating: ' + empRatings[0].Evaluator_Skill_Rating + '%</label>');
                            if (empRatings[0].Final_Evaluator_Skill_Rating != null && empRatings[0].Staging1 == 3)
                                $('#Final_Evaluator_KRARatingoutoffive').html('<label style="color: blue;"> Final Rating: ' + empRatings[0].Final_Evaluator_KRA_Rating + '/5.00</label>');
                            if (empRatings[0].Final_Evaluator_Skill_Rating != null && empRatings[0].Staging1 == 3)
                                $('#Final_Evaluator_SkillsRatingoutoffive').html('<label style="color: blue;"> Final Rating: ' + empRatings[0].Final_Evaluator_Skill_Rating + '%</label>');
                            if (empRatings[0].Overall_Rating1 != null && empRatings[0].Staging1 == 3)
                                $('#OverAllRating').html('<label style="color: blue;"> Overall Rating: ' + empRatings[0].Overall_Rating1 + '</label>');
                            if (empRatings[0].Performance != null && empRatings[0].Staging1 == 3)
                                $('#performanceDiv').html('<label style="color: blue;"> Performance: ' + empRatings[0].Performance + '</label>');
                            if (empRatings[0].Potential != null && empRatings[0].Staging1 == 3)
                                $('#potentialDiv').html('<label style="color: blue;"> Potential: ' + empRatings[0].Potential + '</label>');

                        }
                    }
                }
            }
        })
    }

    function setRangeSliderValues() {

        /*  var slider = document.getElementById("myRange");
          var output = document.getElementById("demo");
          output.innerHTML = slider.value;

          slider.oninput = function () {
              output.innerHTML = this.value;
          }*/
        var sliders = [];

        sliders = $('.slider');
        var sliderVal = $('.range-slider__value');
        var currentSlider;
        var currentSliderval;
        for (var i = 0; i < sliders.length; i++) {
            $('#' + $(sliders)[i].id).on('input', function () {
                $(this).next().html($(this).val());
            });
        }



    }
    function changeweightagecls(data, tabid) {


        var tempCls = '';
        var weigCls = '';
        var EmpORmgnr_Score = 0.0;
        var TotalEmpORmgnr_Score = 0.0;
        var default_weightage = 0.0;
        var Avg_weightage = 0.0;
        var weighted_Score = 0.0;
        var Avgweighted_Score = 0.0;
        var Final_Rating = 0.0;
        var Final_Skills_Rating = 0.0;
        var Performance_Rating = 0.0;
        var Potential_Rating = 0;
        weigCls = '.weightagecls:visible';
        if (data == 1) {
            tempCls = '.EmpWeightcls:visible';
        }
        if (data == 2) {
            tempCls = '.ManagerWeightcls:visible';
        }
        if (data == 3) {
            tempCls = '.AdminWeightcls:visible';
        }
        for (var i = 0; i < $(tempCls).length; i++) {
            EmpORmgnr_Score = $('#' + $(tempCls)[i].id).val() != "" ? parseFloat($('#' + $(tempCls)[i].id).val()) : 0;             //C
            TotalEmpORmgnr_Score = EmpORmgnr_Score / parseInt(MaximumRating);                                                   // E = (C/D)
            default_weightage = $('#' + $(weigCls)[i].id).attr('title') != "" ? parseFloat($('#' + $(weigCls)[i].id).attr('title')) : 0;          //F
            weighted_Score = TotalEmpORmgnr_Score * default_weightage;                                                          //G = (E*F)

            Avg_weightage += default_weightage;                                                                                 // sum of F
            Avgweighted_Score += weighted_Score;                                                                                //sum of G
        }
        if (data == 1) {
            if (tabid == 1) {
                Final_Rating = ((Avgweighted_Score / Avg_weightage) * parseInt(MaximumRating)).toFixed(2);
                Performance_Rating = (Final_Rating >= 0.0 && Final_Rating <= 1.0) ? 'UnSatisfactory' : (Final_Rating > 1.0 && Final_Rating <= 2.0) ? 'Needs Improvement' : (Final_Rating > 2.0 && Final_Rating <= 3.0) ? 'Satisfactory' : (Final_Rating > 3.0 && Final_Rating <= 4.0) ? 'Excellent' : (Final_Rating > 4.0 && Final_Rating <= 5.0) ? 'Outstanding' : 'Not defined';
                $('#KRARatingoutoffive').html('<label style="color: blue;"> KRA Rating: ' + Final_Rating + '/5.00</label>');
            } else {
                Final_Skills_Rating = Math.round(((Avgweighted_Score / Avg_weightage) * 100));
                Potential_Rating = (Final_Skills_Rating >= 0 && Final_Skills_Rating <= 40) ? 'Low' : (Final_Skills_Rating > 40 && Final_Skills_Rating <= 70) ? 'Medium' : (Final_Skills_Rating > 70 && Final_Skills_Rating <= 100) ? 'High' : 'Not defined';
                $('#SkillsRatingoutoffive').html('<label style="color: blue;"> Skills Rating: ' + Final_Skills_Rating + '%</label>');
            }
        } else if (data == 2) {
            if (tabid == 1) {
                Final_Rating = ((Avgweighted_Score / Avg_weightage) * parseInt(MaximumRating)).toFixed(2);
                Performance_Rating = (Final_Rating >= 0.0 && Final_Rating <= 1.0) ? 'UnSatisfactory' : (Final_Rating > 1.0 && Final_Rating <= 2.0) ? 'Needs Improvement' : (Final_Rating > 2.0 && Final_Rating <= 3.0) ? 'Satisfactory' : (Final_Rating > 3.0 && Final_Rating <= 4.0) ? 'Excellent' : (Final_Rating > 4.0 && Final_Rating <= 5.0) ? 'Outstanding' : 'Not defined';
                $('#Evaluator_KRARatingoutoffive').html('<label style="color: blue;"> KRA Rating: ' + Final_Rating + '/5.00 | Performance : ' + Performance_Rating + '</label>');
            } else {
                Final_Skills_Rating = Math.round(((Avgweighted_Score / Avg_weightage) * 100));
                Potential_Rating = (Final_Skills_Rating >= 0 && Final_Skills_Rating <= 40) ? 'Low' : (Final_Skills_Rating > 40 && Final_Skills_Rating <= 70) ? 'Medium' : (Final_Skills_Rating > 70 && Final_Skills_Rating <= 100) ? 'High' : 'Not defined';
                $('#Evaluator_SkillsRatingoutoffive').html('<label style="color: blue;"> Skills Rating: ' + Final_Skills_Rating + '% | Potential : ' + Potential_Rating + '</label>');
            }
        }
        else if (data == 3) {
            if (tabid == 1) {
                Final_Rating = ((Avgweighted_Score / Avg_weightage) * parseInt(MaximumRating)).toFixed(2);
                Performance_Rating = (Final_Rating >= 0.0 && Final_Rating <= 1.0) ? 'UnSatisfactory' : (Final_Rating > 1.0 && Final_Rating <= 2.0) ? 'Needs Improvement' : (Final_Rating > 2.0 && Final_Rating <= 3.0) ? 'Satisfactory' : (Final_Rating > 3.0 && Final_Rating <= 4.0) ? 'Excellent' : (Final_Rating > 4.0 && Final_Rating <= 5.0) ? 'Outstanding' : 'Not defined';
                $('#Final_Evaluator_KRARatingoutoffive').html('<label style="color: blue;"> KRA Rating: ' + Final_Rating + '/5.00 | Performance : ' + Performance_Rating + '</label>');
            } else {
                Final_Skills_Rating = Math.round(((Avgweighted_Score / Avg_weightage) * 100));
                Potential_Rating = (Final_Skills_Rating >= 0 && Final_Skills_Rating <= 40) ? 'Low' : (Final_Skills_Rating > 40 && Final_Skills_Rating <= 70) ? 'Medium' : (Final_Skills_Rating > 70 && Final_Skills_Rating <= 100) ? 'High' : 'Not defined';
                $('#Final_Evaluator_SkillsRatingoutoffive').html('<label style="color: blue;"> Skills Rating: ' + Final_Skills_Rating + '% | Potential : ' + Potential_Rating + '</label>');
            }
        }
    }

    //function onchangeWeightage(thisval, index) {
    //    EmployeeWeightageValueList[index] = thisval.value;
    //    EmployeeWeightageIdList[index] = thisval.id.match(/\d+/)[0]
    //}
    function goBackTab() {

        var ref_this = $("ul.getactivetab li a.active");

        $("ul.getactivetab li a.active").removeClass("active");
        $("div.tab-content div.active").removeClass("active");

        if (ref_this.data("id") == 2) {
            $("ul.getactivetab li a.KraDetailsLink").addClass("active");
            $("div.tab-content div.content_kra").addClass("active");
        } else if (ref_this.data("id") == 3) {
            $("ul.getactivetab li a.DashboardTableLink").addClass("active");
            $("div.tab-content div.content_skills").addClass("active");
        } else if (ref_this.data("id") == 4) {
            $("ul.getactivetab li a.EmployeeAssignedAssetsListLink").addClass("active");
            $("div.tab-content div.content_summary").addClass("active");
        }

    }
    function submitEmployeeSummary(data) {
       // var flagSkillRating;

        if ('@ViewBag.ViewType' == '0') {
            if (empRatings[0].Self_Skill_Rating == null || empRatings[0].Self_KRA_Rating == null) {
                toastr.warning("Please Submit your KRA/Skill ratings");
                return false;
            }
        }
        if ('@ViewBag.ViewType' == '1') {
            if (empRatings[0].Evaluator_KRA_Rating == null || empRatings[0].Evaluator_Skill_Rating == null) {
                toastr.warning("Please Submit your KRA/Skill ratings");
                return false;
            }
        }
        if ('@ViewBag.ViewType' == '2' || '@ViewBag.ViewType' == '3') {
            if (empRatings[0].Final_Evaluator_KRA_Rating == null || empRatings[0].Final_Evaluator_Skill_Rating == null) {
                toastr.warning("Please Submit your KRA/Skill ratings");
                return false;
            }
        }


        var managerid = '';
        var tempCls = '';
        var datecls = '';
        var tempUrl = '';
        var status = sessionrole;
        // tempCls = '.EmpSummaryCls:visible';
        if (data == 1) {
            tempCls = '.EmpSummaryCls:visible';
            managerid = descriptionList[0].Manager_Id;
            EmpId = '@ViewBag.EmpId';
            //    flagRating = empRatings[0].Self_KRA_Rating;
            datecls = '.EmpSummaryDateCls';
        }
        if (data == 2) {
            tempCls = '.ManagerSummaryCls:visible';
            managerid = '@Session["UserID"].ToString()';
            if (descriptionList[0].Manager_Id == managerid) {
                status = '3';
            }
            EmpId = '@ViewBag.EmpId';
            datecls = '.ManagerSummaryDateCls';
            //   flagRating = empRatings[0].Self_KRA_Rating;
        }
        if (data == 3) {
            tempCls = '.AdminSummaryCls:visible';
            managerid = '@Session["UserID"].ToString()';
            EmpId = '@ViewBag.EmpId';
            datecls = '.AdminSummaryDateCls';

        }
        //if (flagKra == false || flagSkill == false)        //||empRatings.length==0)
        //{
        //    toastr.warning("Please Submit your KRA/Skill ratings");
        //    return false;
        //}

        var tempEmployeeSummaryValueList = '';
        var tempEmployeeSummaryIdList = '';
        var tempEmployeeSummaryDateList = '';
        if (data == 1) {

            if ($('.detailBox').length != $('.empCommentBox').length) {
                bootbox.alert("please fill out all the summary fields");
                return false;
            }
            for (var i = 0; i < $(tempCls).length; i++) {

                tempEmployeeSummaryValueList += $('#' + $(tempCls)[i].id).text().trim() + ',';
                tempEmployeeSummaryIdList += $(tempCls)[i].id.match(/\d+/)[0] + ',';
                //   tempEmployeeSummaryDateList += $('#' + $(datecls)[i].id).text() + ',';

            }

        }

        if (data == 2) {

            //if ($('#feedBackCategory').val() == 0 || $('#feedBackCategory').val() == null || $('#feedBackCategory').val() == undefined) {
            //    toastr.warning('Please select feedback category');
            //    return false;
            //}

            if (!($('#reward,#positive,#observation,#training,#negative').hasClass('lgFBFntSize'))) {
                toastr.warning('Please select feedback category');
                return false;
            }

            for (var i = 0; i < $('.detailBox').length; i++) {
                //if ($('.managerCommentBox')[i] == undefined) {
                //    tempEmployeeSummaryValueList += "" + ',';
                //    tempEmployeeSummaryIdList += $('.taskDescription')[i].id.match(/\d+/)[0] + ',';
                //}
                if ($("#" + $('.commentList').find('.managercmtlist')[i].id).find('li').hasClass('managerCommentBox')) {
                    tempEmployeeSummaryValueList += $("#" + $('.commentList').find('.managercmtlist')[i].id).find('p').text() + ',';
                    tempEmployeeSummaryIdList += $('.taskDescription')[i].id.match(/\d+/)[0] + ',';
                }
                else {

                    tempEmployeeSummaryValueList += "" + ',';
                    tempEmployeeSummaryIdList += $('.taskDescription')[i].id.match(/\d+/)[0] + ',';
                }

                //feedBackCategory = $('#feedBackCategory').val();
            }
        }
        if (data == 3) {

            //if ($('#feedBackCategory').val() == 0 || $('#feedBackCategory').val() == null || $('#feedBackCategory').val() == undefined) {
            //    toastr.warning('Please select feedback category');
            //    return false;
            //}
            if (!($('#reward,#positive,#observation,#training,#negative').hasClass('lgFBFntSize'))) {
                toastr.warning('Please select feedback category');
                return false;
            }

            for (var i = 0; i < $('.detailBox').length; i++) {

                if ($("#" + $('.commentList').find('.finalcmtlist')[i].id).find('li').hasClass('adminCommentBox')) {
                    tempEmployeeSummaryValueList += $("#" + $('.commentList').find('.finalcmtlist')[i].id).find('p').text() + ',';
                    tempEmployeeSummaryIdList += $('.taskDescription')[i].id.match(/\d+/)[0] + ',';
                }
                else {

                    tempEmployeeSummaryValueList += "" + ',';
                    tempEmployeeSummaryIdList += $('.taskDescription')[i].id.match(/\d+/)[0] + ',';
                }




                //if ($('.adminCommentBox')[i] == undefined) {
                //    tempEmployeeSummaryValueList += "" + ',';
                //    tempEmployeeSummaryIdList += $('.taskDescription')[i].id.match(/\d+/)[0] + ',';
                //}
                //else {
                //    tempEmployeeSummaryValueList += $('#' + $('.adminCommentBox')[i].id).find('p').text() + ',';
                //    tempEmployeeSummaryIdList += $(tempCls)[i].id.match(/\d+/)[0] + ',';
                //}

                //feedBackCategory = $('#feedBackCategory').val();

            }
        }


        tempEmployeeSummaryValueList = tempEmployeeSummaryValueList.substring(0, tempEmployeeSummaryValueList.length - 1);
        tempEmployeeSummaryIdList = tempEmployeeSummaryIdList.substring(0, tempEmployeeSummaryIdList.length - 1);
        tempEmployeeSummaryDateList = tempEmployeeSummaryDateList.substring(0, tempEmployeeSummaryDateList.length - 1);

        bootbox.confirm('Are you sure do you want to Submit your Appraisal details?', function (result) {
            if (result) {

                $.ajax({
                    type: 'post',
                    url: '@Url.Content("~/PerformanceAppraisal/AddEmployeeSummaryDetails")',
                    data: { idList: tempEmployeeSummaryIdList, valueList: tempEmployeeSummaryValueList, status: status, FeedBackCatagory: feedBackCategory, managerid: managerid, empId: EmpId, date: tempEmployeeSummaryDateList.replace(/on /g, ''), AppraisalProcessId: descriptionList[0].Appraisal_Process_Period_Id, isSelfDirectAppraisalPage: isSelfDirectAppraisalPage },
                    success: function (data) {
                        if (data.result == 1) {
                            toastr.success("Saved Successfully");
                            $('#Content_KRA').removeClass('active');
                            $('#Content_Skill').addClass('active');
                            setTimeout(function () {
                                location.reload();
                                $("html, body").animate({ scrollTop: $('.mainContent').position().top }, "fast");
                            }, 2000);

                        }
                        else if (data.success == false && (data.errMsg != '' || data.errMsg != null || data.errMsg != undefined)) {
                            toastr.warning(data.errMsg);
                        }
                        else {
                            toastr.error("Fail");
                        }
                    }
                });
            }
        });
    }
    function saveQuestEmployeeWeightage(data, tabname) {
        var tempCls = '';
        var weigCls = '';
        var tempUrl = '@Url.Content("~/PerformanceAppraisal/AddKra_SkillWeightage")';
        var status = sessionrole;
        if (data == 1) {
            tempCls = '.EmpWeightcls:visible';

        }
        if (data == 2) {
            tempCls = '.ManagerWeightcls:visible';
            if ('@Session["UserID"].ToString()' == descriptionList[0].Manager_Id) {
                status = '3';
            }
        }
        if (data == 3) {
            tempCls = '.AdminWeightcls:visible';
        }
        weigCls = '.weightagecls:visible';
        var tempWeightageValueList = '';
        var weightageValue = '';
        var weightageValue = '';
        var tempWeightageIdList = '';
        var EmpORmgnrScore = 0.0;
        var TotalEmpORmgnrScore = 0.0;
        var defaultweightage = 0.0;
        var Avgweightage = 0.0;
        var weightedScore = 0.0;
        var AvgweightedScore = 0.0;
        var FinalRating = 0.0;
        $('.field-validation-valid').text('');
        $('.field-validation-valid').show();
        for (var i = 0; i < $(tempCls).length; i++) {
            if ($('#' + $(tempCls)[i].id).val() == '') {
                $('<span class="field-validation-valid">' + ' This field is required...!</span>').css('color', 'red').insertAfter('#' + $(tempCls)[i].id);
            }
            else {
                tempWeightageValueList += $('#' + $(tempCls)[i].id).val() + ',';
                tempWeightageIdList += $(tempCls)[i].id.match(/\d+/)[0] + ',';
            }
        }
        if ($('.field-validation-valid').text() != '') {
            return false;
        }

        for (var i = 0; i < $(tempCls).length; i++) {
            EmpORmgnrScore = parseFloat($('#' + $(tempCls)[i].id).val());           //C
            TotalEmpORmgnrScore = EmpORmgnrScore / parseInt(MaximumRating);       // E = (C/D)
            defaultweightage = parseFloat($('#' + $(weigCls)[i].id).attr('title'));       //F
            weightedScore = TotalEmpORmgnrScore * defaultweightage;              //G = (E*F)

            Avgweightage += defaultweightage;                                   // sum of F
            AvgweightedScore += weightedScore;                                  //sum of G
        }

        if (tabname == 'KRA') {
            FinalRating = (AvgweightedScore / Avgweightage) * parseInt(MaximumRating);
            flagKra = true;
        }
        else {
            FinalRating = Math.round(((AvgweightedScore / Avgweightage) * 100));
            flagSkill = true;
        }

        tempWeightageValueList = tempWeightageValueList.substring(0, tempWeightageValueList.length - 1);
        tempWeightageIdList = tempWeightageIdList.substring(0, tempWeightageIdList.length - 1);

        var empid = '@ViewBag.EmpId';
        $.ajax({
            type: 'post',
            url: tempUrl,
            data: { idList: tempWeightageIdList, valueList: tempWeightageValueList, status: status, TabName: tabname, FinalRating: FinalRating, EmpId: empid, AppraisalProcessId: descriptionList[0].Appraisal_Process_Period_Id, isSelfDirectAppraisalPage: isSelfDirectAppraisalPage },
            success: function (data) {
                if (data.result == 1) {

                    var ref_this = $("ul.getactivetab li a.active");
                    if (ref_this.data("id") == 4) {
                        if (isSelfDirectAppraisalPage == "False") {
                            closeTab();
                        }
                    } else {
                        $("ul.getactivetab li a.active").removeClass("active");
                        $("div.tab-content div.active").removeClass("active");
                        if (ref_this.data("id") == 1) {
                            $("ul.getactivetab li a.DashboardTableLink").addClass("active");
                            $("div.tab-content div.content_skills").addClass("active");
                        } else if (ref_this.data("id") == 2) {
                            $("ul.getactivetab li a.EmployeeAssignedAssetsListLink").addClass("active");
                            $("div.tab-content div.content_summary").addClass("active");
                        } else if (ref_this.data("id") == 3) {
                            $("ul.getactivetab li a.ManagerCommends").addClass("active");
                            $("div.tab-content div.manager_commends").addClass("active");
                        }
                    }
                    toastr.success("Saved Successfully");
                    getempRatingsForKraSkills(isSelfDirectAppraisalPage, EMPLOYEE_ID, APPRAISAL_PROCESS_PERIOD_ID);
                }
                else {
                    toastr.error("Faild to Save");
                }
            }
        })
    }

</script>
